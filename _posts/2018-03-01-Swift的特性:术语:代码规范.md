---
layout: post
title: 'Swift的特性/术语/代码规范'
date: 2018-03-01
author: 李大鹏
cover: ''
tags: Swift
---

### 1. 特性
* Swift 既是一门高层级语言，又是一门低层级语言。
  * 很容易创建高阶函数，如map和reduce。
  * 可直接编译为原生二进制可执行文件，性能与C代码程序媲美。
  * 兼顾高低层级，如：将数组通过闭包映射到另一个数组编译出汇编码，达到直接对连续内存循环的效果。
* Swift是一门多范式的语言，面向对象、纯函数式、C类指针运算。
  * 双刃剑。有更多可用选择，代码不会受限，也会陷入其他语言的险境。
  * 可使用大部分Objective-C功能，消息发送、运行时、KVO等。
  * 拥有泛型，协议、值类型、闭包等特性。
* Swift十分灵活。鼓励从下向上的编程方式，方便编写通用可重用组件。
* Swift代码可以做到紧凑、精确，同时保持清晰。
  * 类型推断
  * 移除分号/括号
  * 泛型和协议扩展，封装和复用。
* Swfit在实践中总是安全的，除非有意破坏。
  * 如C#中的终止方法finalizer，运行在垃圾回收线程上，不确定执行。Swift采用引用计数，终止方法deinit的调用可以确定和预测。
  * 数组越界抛出异常，而不是继续使用可能取到的错误值。
  * 对存在风险的方法提出警告，如使用UnsafeMutablePoint类型，在闭包返回ptr。
* Swfit 是一门独断的语言，年轻、博客或文章资料有误，批判的验光审视和思考，警惕过时信息。
* Swift 在持续进化。

### 2. 术语
* 值（Value）：不变，永久的，从不会改变。
  * 字面量：1，true，[1,2,3]。
  * 运行时生成，如：计算5的平方的到一个值。
* 变量（variable）：变量指向一个值，可以改变值，用新值替换。
* 常量变量（constant variables）：简称常量，不能再次赋值，用let声明。
* 值类型（value type）：结构体（struct）和枚举（enum），赋值时对内容复制。
* 引用（reference）：特殊类型的值，“指向”另一个值的值，两个引用可指向同一个值，被程序不同部分所改变。
* 引用类型（reference type）
  * 类（class），最广泛的引用类型
  * 其他：withUnsageMutablePointer和类似方法得到的也是指针。
  * 可用let声明，使引用变为常量，所引用的对象仍可改变。
* 对象（object）：类的实例，通过变量持有对它的引用，使用引用访问。
* 同一性（identity）：===检查两个变量是否引用同一个对象。==运算符被实现时，可以判断两个变量是否相等。
  * ==，结构相等。
  * ===，指针相等或引用相等。
* 值语义（value semantics）：是否执行深复制。
* 高阶函数（higher-order function）：一个函数接受别的函数作为参数，或者一个函数的返回值是函数。
* 闭包（closure）:如果一个函数被定义在外层作用域中，但是被传递出这个作用域，它将能够“捕获”局部变量的函数。
  * 闭合变量：这些局部变量将存在于函数中，不会随着局部作用域的结束而消亡，函数也将持有它们的状态。
  * 闭包表达式（closure expression）：函数可以通过 func 关键字来定义，也可以通过 { } 这样的简短的闭包表达式来定义。
* 方法（method）：定义在类或者协议中的函数，它们有一个隐式的 self 参数。
* 柯里化函数 (curried function)：如果一个函数不是接受多个参数，而是只接受部分参数，然后返回一个接受其余参数的函数的话。
* 自由函数 (free function)：不是方法的函数。
* 静态派发 (statically dispatched)：自由函数和那些在结构体上调用的方法，编译器可能能够内联这些函数，
  * 内联 (inline)：完全不去做函数调用，而是将函数调用替换为函数中需要执行的代码。
  * 优化器还还能够帮助丢弃或者简化那些在编译时就能确定不会被实际执行的代码。
* 动态派发 (dynamically dispatched) ：类或者协议上的方法可能是动态派发，动态特性通过vtable、selector 和 objc_msgSend 来完成，vtable和Java或C++类似。
* 多态 (polymorphic)特性：
  * 子类型和方法重写 (overriding)，根据类型的不同，同样的方法会呈现出不同的行为。
  * 重载 (overloading)：为不同的类型多次写同一个函数的行为。
  * 泛型：一次性地编写能够接受任意类型的的函数或者方法，不过这些方法的实现会各有不同。与方法重写不同的是，泛型中的方法在编译期间就是静态已知的。

### 3. 代码规范
* 对于命名，在使用时能清晰表意是最重要。
* 简洁经常有助于代码清晰，但是简洁本身不应该独自成为我们编码的目标。
* 务必为函数添加文档注释 — 特别是泛型函数。
* 类型使用大写字母开头，函数、变量和枚举成员使用小写字母开头，两者都使用驼峰式命名法。
* 使用类型推断。省略掉显而易见的类型会有助于提高可读性。
* 如果存在歧义或者在进行定义的时候不要使用类型推断。(比如 func 就需要显式地指定返回类型)
* 优先选择结构体，只在确实需要使用到类特有的特性或者是引用语义时才使用类。
* 除非你的设计就是希望某个类被继承使用，否则都应该将它们标记为 final。
* 除非一个闭包后面立即跟随有左括号，否则都应该使用尾随闭包 (trailing closure) 的语法。
* 使用 guard 来提早退出方法。
* 避免对可选值进行强制解包和隐式强制解包。它们偶尔有用，但是经常需要使用它们的话往往意味着有其他不妥的地方。
* 不要写重复的代码。如果你发现你写了好几次类似的代码片段的话，试着将它们提取到一个函数里，并且考虑将这个函数转化为协议扩展的可能性。
* 试着去使用 map 和 reduce，但这不是强制的。当合适的时候，使用 for 循环也无可厚非。
* 试着去使用不可变值：除非你需要改变某个值，否则都应该使用 let 来声明变量。不过如果能让代码更加清晰高效的话，也可以选择使用可变的版本。用函数将可变的部分封装起来，可以把它带来的副作用进行隔离。
* Swift 的泛型可能会导致非常长的函数签名，可将函数声明强制写成几行。
* 除非你确实需要，否则不要使用 self.。不过在闭包表达式中，self 是被强制使用的，这是一个清晰的信号，表明闭包将会捕获 self。
* 尽可能地对现有的类型和协议进行扩展，而不是写一些全局函数。这有助于提高可读性，让别人更容易发现你的代码。

### 4. 补充
* 语法糖：指计算机语言中添加的某种语法，这种语法对语言的功能并没有影响，但是更方便程序员使用。通常来说使用语法糖能够增加程序的可读性，从而减少程序代码出错的机会。
* 纯函数式编程：纯函数式编程语言中的变量也不是命令式编程语言中的变量，即存储状态的单元，而是代数中的变量，即一个值的名称。
  * 变量的值是不可变的（immutable），也就是说不允许像命令式编程语言中那样多次给一个变量赋值。比如说在命令式编程语言我们写“x = x + 1”，这依赖可变状态的事实，拿给程序员看说是对的，但拿给数学家看，却被认为这个等式为假。
  * 单子，很多类型都有类似map和flatMap的方法，而这些方法都有那种类型的签名。这是一种十分常见的模式，这种模式的名字叫做单子。
    * 一个函子，是一种表示为Type<T>的类型。
      * 封装了另一种类型（类似于封装了某个T类型的Array<T>或Optional<T>）。
      * 有一个具有(T->U) -> Type\<U>签名的map方法。
    * 一个单子是一种类型，它：
      * 是一个函子（所以它封装了一个T类型，拥有一个map方法）
      * 还有一个具有(T->Type\<U>) -> Type\<U>签名的flatMap方法
* 类型推断：在声明常量或者变量的同时使用字面量进行了初始化，推断你希望这个常量的类型。如：
```
let meaningOfLife = 42  // meaningOfLife 被推断为类型 Int
```
