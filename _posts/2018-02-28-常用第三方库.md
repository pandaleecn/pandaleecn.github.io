---
layout: post
title: '常用第三方库'
date: 2018-02-28
author: 李大鹏
cover: ''
tags: iOS 第三方库
---
### 1. AFNetworking
* iOS客户端第三方网络框架
* 框架图
![](http://files.pandaleo.cn/ac13180141824eba476dbf29c7cfa7f5.png?imageMogr2/thumbnail/!50p)
    * 会话，NSURLSession
    * 网络监听模块，监听网络变化
    * 网络安全模块
    * 请求序列化封装
    * 响应序列化封装
    * UIKit集成模块，原生控件分类的添加
* 主要类关系图
![](http://files.pandaleo.cn/d3cef249cf0c3655fb144cb52a718209.png?imageMogr2/thumbnail/!50p)
    * AFURLSessionManager，核心类
    * AFHTTPSessionManager，实际应用中使用频度最高
    * AFURLRequestSerialzation，根据传递参数拼接出最终结果
    * AFURLResponseSerialzation，解析网络请求的返回结果。如：JSON字符串，通过这个类，内部调用系统JSON解析相关类方法，解析出想要的结果；图片数据，通过ImageWithData产生UIImage结果。
    * NSURLSession，会话模块
    * AFSecurityPolicy，保障网络安全，包括证书和其他验证
    * AFNetworkReachabilityManager，监听网络连接，和系统第三方库Reachability功能相同
* AFURLSessionManager主要工作
    * 创建和管理NSURLSession、调用系统API生成NSURLSessionTask，NSURLSessionTask对应一个网络请求
    * 实现NSURLSessionDelegate等协议的代理方法，处理请求过程中网络请求数据、重定向等情况
    * 引入AFsecurityPolicy保证请求安全，包含证书校验、公钥认证等
    * 引入AFNetworkReachabilityManager监控网络状态
* 发送一个Get方式的HTTP请求

### 2. SDWebImageView
* 一个异步下载图片并且支持缓存的框架
* 架构简图
![](http://files.pandaleo.cn/568102773d77e10dcdcaa474b9d7ca6d.png?imageMogr2/thumbnail/!50p)
    * UIImageView + WebCache，从网络下载或缓存提取图片
    * SDWebImageManager，核心类
    * SDImageCache，处理图片缓存，磁盘缓存/内存缓存
    * SDWebImageDownloader
* 加载图片流程
![](http://files.pandaleo.cn/94dfe62b369083e11abbef4a31ae3714.png?imageMogr2/thumbnail/!50p)
    * 查找内存/磁盘缓存，通过图片URL查找缓存中的key
    * 如果没找到，通过网络下载。

### 3. ReactiveCocoa
* 函数响应式编程框架
* 什么是RAC？
![](http://files.pandaleo.cn/4bec1b0e07447e959473dd9d7f1bc81a.png?imageMogr2/thumbnail/!50p)
    * RAC是函数响应式编程的第三方库，涉及到信号和订阅
* 信号，核心概念
    * ReactiveCocoa中的核心类RACSignal
![](http://files.pandaleo.cn/ac9b6326eff72cd258266f3600d02688.png?imageMogr2/thumbnail/!50p)
    * RACStream
        * 抽象方法：empty、return、bind、concat、zipWith
        * 封装Operation：map、take、skip、ignore、filter等
    * 信号，代表一连串状态
![](http://files.pandaleo.cn/4ec805c42b9cb6c3d0018923a873228c.png?imageMogr2/thumbnail/!50p)
        * 在状态改变时，对应的订阅者RACSubscriber就会收到通知执行相应的指令
    * 信号应用的设计模式：类簇/抽象工厂，返回抽象对象。返回同样对象，但是通过不同方法创建的对象仍然不同。
* 订阅（RACSubscriber）
    * 工作流程
![](http://files.pandaleo.cn/f1eced4750843efb378cb4999d2234cb.png?imageMogr2/thumbnail/!50p)
    * 内部原理
![](http://files.pandaleo.cn/dd3c600c7dcc6b2a985c7a7a885eb17f.png?imageMogr2/thumbnail/!50p)
        * 当初始化RACSubcriber类时，内部持有成员变量didSubscribe的block
        * 当调用subscriber方法时，背部调用didSubscribe的block。  


```          
{
    [RACSignal return:@3];
    [RACSignal subScribedNext:^(id x) {
        NSLog(@"%@“,x); // 打印3
    }];
}
```

### 4. AsyncDisplayKit
* ASDK，提高iOS界面渲染性能的一个框架
* 主要处理问题
![](http://files.pandaleo.cn/9d699ef4e957b288290c2e12bb859eaf.png?imageMogr2/thumbnail/!50p)
通过减轻主线程压力，将更多地事情转移到子线程。
* 基本原理
![](http://files.pandaleo.cn/7321e9bf1be7e943dec33e3760e0f87f.png?imageMogr2/thumbnail/!50p)

    * 正常情况下，系统将UIView作为CALayer的Delegate，CALayer作为UIView的成员变量，负责UI视图的展示工作。
    * ASDK在此之上，封装了ASNode类包含.view和.node成员变量，对UIView进行包装，可以将文本计算、UI布局等处理，通过操作ASNode处理，而ASNode又可以放入后台处理。
        * .view可以生成一个view
        * UIView包含.node成员属性，可以获取对应的节点。
        * 线程安全，可以放入后台处理。
    * 总结
        * 针对ASNode的修改和提交，会对其进行封装并提交到一个全局容器当装
        * ASDK也在RunLoop中注册了一个Observer
        * 当RunLoop进入休眠前，ASDK执行该loop内提高的所有任务

### 5. 总结
* AFNetworking的整体结构是怎样的？
    * 通过架构图对整体进行描述
    * 分为会话模块、网络监听模块、安全模块
    * 核心类为AFURLSessionManager，最常用类为AFHTTPSessionManager。
* SDWebImage框架是怎样加载图片的？
    * 查找内存，查找磁盘，都没有进行网络下载。
    * 内存相关的设计。
        * LRU，最近最久未使用算法实现淘汰策略。
* RAC的信号订阅是什么意思？
    * 信号是一连串状态的抽象；
    * 订阅信号是通过RACSubscriber实现，对block作为成员变量持有。具体调用subscriber时，调用订阅者的next方法执行block。
* ASDK的实现原理时怎样的？
    * 封装一个ASNode节点，对视图的属性设置都转化为对ASNode的设置，而ASNode又可以放入后台设置。在Runloop将结束时接收通知，提取全局容器中的ASNode，一次性设置到UIView。
