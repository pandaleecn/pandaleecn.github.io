---
layout: post
title: '悦读笔记-待整理'
date: 2020-08-25
author: 李大鹏
cover: ''
tags: iOS
---

- 浅谈架构

  - MVC，Model 数据管理者，View 数据展示者，Controller 数据加工者。

- 设计模式

  - 策略（strategy）模式，实现 IM 系统的内容发送时，由于发送类型包含文本、图片、语音、视频多种格式的消息，导致 Manager 略显臃肿。通过引入策略模式，增加 MassegetSend 类，发送方通过调用对应的策略进行内容的发送，如：文本发送策略、语音发送策略，从而拆分了臃肿的 Manager。
  - 中间人（Mediator）模式，在订单系统开发时，会由于订单业务较长，多人协同开发时会存在业务间的依赖。通过建立中间人模块 OrderManager，采用 AOP 将定制过程分片，如：钻石选择、款式选择，解决横向依赖的问题。
  - Target/action 模式，一个对象包含一些生成一个消息表达式的元素，当一个确定事件出现时，把这些元素放到一起组成消息并发送这个消息。
  - Promise 模式

- `@synchronized` 和 `@dispatch_once`
  - synchronized，objc_sync_enter 对方法添加递归互斥锁，执行线程安全代码，objc_sync_exit 时解锁。
  - dispatch_once 首次调用执行 block 时设置 predicate 为 DISPATCH_ONCE_DONE(~0l)，其他线程调用会等待，加入到信号量链表中，执行完之后唤醒。
  - dispatch_once 单例效率更高。内部原子操作来替代锁、通过信号量实现线程同步、针对处理器优化、if 判断语句上也做了优化。
