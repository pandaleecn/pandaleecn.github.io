---
layout: post
title: '面试题-待整理'
date: 2018-05-03-面试题-待整理
author: 李大鹏
cover: ''
tags: iOS
---

# 真题

## Timi，2020 年 09 月 07 日 10:00

### 1. iOS 内存管理是怎样的？

- iOS 中内存管理主要有三种方案：TagPointer、NOPointer_isa、SideTable
  - TagPointer 针对基本类型、长度较小的字符串进行封装，使用地址表达更多信息
  - NOPointer_isa，64 位 isa 指针，32 位存储地址，其他存储引用计数、使用 c++、是否有引用计数表、弱引用表、关联对象等状态信息
  - SideTables，散列表，散列表是二维结构，每张表中其中包含自旋锁、引用计数表、弱引用表。
- 接着问 ：散列表的数据结构是什么？一个对象是如何找到自己的引用计数和弱引用表的？
  - 首先，通过 isa 指针标志位，判断是否使用了引用计数表、弱引用计数表
  - 使用 isa 进行 hash 算法，在 SideTables 多张表中，找到对应的 SideTable
  - 在 SideTable 中找到引用计数表和弱引用计数表
- 散列表中存储了什么，各有什么特点？
  - SideTable 中包含了引用计数表、弱引用计数表、自旋锁
  - 自旋锁保证对象在引用计数管理时的线程安全
  - 多张表结构，引入分离锁概念，提高了多线程下的访问效率。
- 引用计数表是什么？ 怎么实现的？
  - 哈希表，通过 isa 指针找到对应的引用计数 size

### 2. MLeakerFinder 有使用过吗？让你实现一个这样的框架怎么实现？

- ~~为 NSObject 添加分类，对其添加弱引用~~
- 为基类 NSObject 添加分类， `-willDealloc`方法，添加弱引用指针指向 self，3 秒后通过这个弱指针调用`-assertNotDealloc`中断言
- 为 UIViewController 添加分类，利用 runtime 交换方法 hook 住`viewDidDisappear`方法，在页面退出 2s 后，检查这个弱引用是否存在
- 如果存在则提示内存泄露，利用 `FBRetainCycleDetector` 框架，查找具体泄露时的调用栈
- [MLeaksFinder 学习记录](https://blog.csdn.net/Zsk_Zane/article/details/94359841)

### 3. 断点续传是怎样实现的？要注意什么？

- 检查服务器文件信息、本地文件，对比大小
- 比服务器小，利用 Range 断点续传
- 比服务器大，重传
- 和服务器一样，完成
- AFN 默认 60s 超时

### 4. 如何实现一个常驻线程

- 启动 NSTread，在线程方法中获取 currentRunLoop，启用 RunLoop，为 RunLoop 添加 Source1
- 开启 while 循环，在 isAlwaysRun 标志位为 true 时，不断单次运行 RunLoop
- 线程结束后移除 runloop，释放 source1

### 5. 如果让你设计一个阅读时长的统计框架该如何设计？

### 6. 我看你简历上写 iOS 逆向，逆向开发你做过哪些事情？

### 7. 看过哪些第三方的源码，可以跟我说说内部细节吗？

### 8. 快速排序从简单到容易，一步步是怎么优化的？如果是一个近乎有序的数据该怎么做？稳定性是怎样？

### 9. 二叉树层序遍历然后用链表输出？

#### 题目

- OC 中如何创建线程
- OC 中如何使用多线程
- OC 中的 volatile 关键字的作用是什么

  - 一个定义为 volatile 的变量是说这变量可能会被意想不到地改变，这样，编译器就不会去假设这个变量的值了。精确地说就是，优化器在用到这个变量时必须每次都小心地重新读取这个变量的值，而不是使用保存在寄存器里的备份。下面是 volatile 变量的几个例子：
  - 并行设备的硬件寄存器（如：状态寄存器）；
  - 一个中断服务子程序中会访问到的非自动变量(Non-automatic variables)；
  - 多线程应用中被几个任务共享的变量。

- OC 函数底层实现原理
  OC 采用消息发送策略，选择器向接收器发送消息，编译阶段无法知道对象是否有对应的方法，运行时根据 isa 指针，找到对象所属的类结构体，然后结合类中的缓存方法列表指针和虚函数指针找到选择器对应的 SEL 选择器类型变量，如果找到则 SEL 变量对应的 IMP 指针找到方法实现。如果找不到对应的方法，则会启动消息转发机制，如果仍然失败，抛出异常或崩溃。

- JSAPI 实现原理

  - JavaScriptCore 为原生编程语言 Objective-C、Swift 提供调用 JavaScript 程序的动态能力，还能 为 JavaScript 提供原生能力来弥补前端所缺能力。
  - JavaScriptCore 框架主要 由 JSVirtualMachine 、JSContext、JSValue 类组成。
    - JSVirturalMachine 的作用，是为 JavaScript 代码的运行提供一个虚拟机环境。
    - JSContext 是 JavaScript 运行环境的上下文，负责原生和 JavaScript 的数据传递。
    - JSValue 是 JavaScript 的值对象，用来记录 JavaScript 的原始值，并提供进行原生值对象转换的接口方法。
    - JSVirtualMachine 里包含了多个 JSContext， 同一个 JSContext 中又可以有多个 JSValue。
  - JSVirtualMachine 、JSContext、JSValue 类提供的接口，能够让原生应用执行 JavaScript 代码，访问 JavaScript 变量，访问和执行 JavaScript 函数;也能够让 JavaScript 执行原生代码，使用原生输出的类。
  - JavaScriptCore 引擎，真是的虚拟机，包含：Parser、Interpreter、Compiler、GC
    - 由 Parser 进行词法分析、语法分析，生成字节码。
    - 由 Interpreter 进行解释执行

- 关注内存问题，避免内存溢出和释放不及时

  - 原因
    - autoreleasepool 在当前 RunLoop 结束时才会 drain，释放其中对象的内存，由于 GCD 延迟执行或循环引用导致 RunLoop 延迟结束。
  - 场景
    - dispatch_after , dispatch_after 延时 N 秒, 控制器就会在 N 秒之后释放
      - 方案 1，使用 weakSelf
      - 方案 2，weak strong
    - 使用定时器时，self 强引用定时器，定时器强引用 target，target 强引用 self。导致循环引用，会引起延时释放。
      - 使用 HWWeakTimer 、Block、自己手写代理，通过代理将事件转发给 weak self。

- 编译原理，简述编译过程
- C++必备
- 底层技术点、组件化，性能优化，系统架构，到跨平台
- 项目 OSI 七层模型 TCP/UDPHTTPHTTPS（实现机制，流程），C++的 static 关键字

- iOS 内存泄露题
- 崩溃原理探究与拦截
- 静态库与动态库
  - 理解静态库与动态库的本质
  - 理解 tdb、framework 格式与动态库的关系
  - 理解标志-noall_load, -all_load, -ObjC, -force_load 的作用
  - 理解静态库与动态库分发体积与链接体积的大小
  - 理解静态链接过程
- 每种类型占用的内存资源

- GPUImage 的滤镜链问题

- 图片处理，压缩、缩放、调整方向、加效果
- APSF 发布、签名
- RPAPatch 对一些行为更改，调用结构时，设计哪些内容？执行流程？a 类的 b 函数
- 在子线程启动 timer，需要注意哪些？
- RAC 原理
- 组建 cell，高度计算问题处理

#### 操作系统

- CPU 的一级、二级缓存的作用是什么？
- 多核处理器的一级、二级缓存是如何同步的？
- 编译原理
  - 简述编译过程
  - 语法分析的实现方法有哪些，具体是怎样实现的

2. 二面
   - 计算机体系结构
   - 计算机网络、算法

#### C 语言

C 语言中 static 有哪些应用场景，区别是什么？
C 语言中 extern 有哪些应用场景，区别是什么？
struct 与 union 的区别是什么
请解释 struct 中不同变量之间的对齐问题 OC 是在 C 语言上的扩展
请描述 OC 是如何实现面向对象、如何实现多态的

#### 通过流程

- T3.2 工程师，8 面。
- 3 轮技术面试，3 轮通道面试，1 次 PM 面试，一次 HR 面试
  - 技术上问的比较详细，好在我有几年的 iOS 开发，所以没有问题
  - PM 面试主要是考了比较难的逻辑题目，这个也问题不大，
  - 技术通道面试比较难，基本和 iOS 没有太大关系，
    - 后台技术，分布式都有涉及，算法也有，过去工作经验也有，
  - HR 主要看是否能够敬业，态度等等。主要考察过去工作细节，逻辑能力，表达能力，学习能力，知识面，反思能力，工作态度，职业规划等等。
