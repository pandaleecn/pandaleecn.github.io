I".<h3 id="ä¸€å…­å¤§è®¾è®¡åŸåˆ™">ä¸€ã€å…­å¤§è®¾è®¡åŸåˆ™</h3>
<h4 id="1-å•ä¸€èŒè´£åŸåˆ™">1. å•ä¸€èŒè´£åŸåˆ™</h4>
<ul>
  <li>ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä»¶äº‹</li>
  <li>å¦‚ï¼šUIViewå’ŒCALayerï¼ŒUIViewåªè´Ÿè´£æ—¶é—´ä¼ é€’å’Œå“åº”ï¼ŒCALayeråªè´Ÿè´£åŠ¨ç”»å’Œè§†å›¾çš„æ˜¾ç¤º</li>
</ul>

<h4 id="2-å¼€é—­åŸåˆ™">2. å¼€é—­åŸåˆ™</h4>
<ul>
  <li>å¯¹ä¿®æ”¹å…³é—­ã€å¯¹æ‰©å±•å¼€æ”¾</li>
  <li>å¯¹ç±»çš„å®šä¹‰åº”è¯¥è€ƒè™‘å…¶æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œå¯¹éœ€æ±‚åº”è¯¥è€ƒè™‘åç»­çš„ç‰ˆæœ¬å’Œè¿­ä»£ï¼Œè°¨æ…å®šä¹‰æˆå‘˜å˜é‡ï¼Œå°½é‡é¿å…å¯¹ç±»çš„åå¤ä¿®æ”¹ã€‚</li>
  <li>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå®šä¹‰å¥½æ•°æ®ç»“æ„ï¼Œåç»­åªéœ€è¦æ·»åŠ æ¥å£å’Œå­ç±»é›†æˆã€‚</li>
</ul>

<h4 id="3-æ¥å£éš”ç¦»åŸåˆ™">3. æ¥å£éš”ç¦»åŸåˆ™</h4>
<ul>
  <li>ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„åè®®ã€è€Œä¸æ˜¯ä¸€ä¸ªåºå¤§è‡ƒè‚¿çš„åè®®ã€‚</li>
  <li>å¦‚ï¼šUITableViewDelegateä¸“é—¨å¤„ç†UITableViewçš„ä»£ç†äº‹ä»¶ï¼ŒUITableViewDataSourceä¸“é—¨UITableViewçš„è·å–æ•°æ®æº</li>
  <li>åè®®ä¸­çš„æ–¹æ³•åº”å½“å°½é‡å°‘</li>
</ul>

<h4 id="4-ä¾èµ–å€’ç½®åŸåˆ™">4. ä¾èµ–å€’ç½®åŸåˆ™</h4>
<ul>
  <li>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºå…·ä½“å®ç°ï¼Œå…·ä½“å®ç°å¯ä»¥ä¾èµ–äºæŠ½è±¡</li>
  <li>å¦‚ï¼šå®šä¹‰æ•°æ®è®¿é—®ï¼Œå¢åˆ æ”¹æŸ¥æ¥å£æ–¹æ³•æ—¶ï¼Œæ‰€æœ‰ä¸Šå±‚çš„ä¸šåŠ¡è°ƒç”¨éƒ½åº”è¯¥ä¾èµ–å®šä¹‰çš„æŠ½è±¡æ¥å£ã€‚æ¥å£å†…éƒ¨çš„æ¥å£å®ç°ï¼Œç”¨æ–‡ä»¶æˆ–æ•°æ®åº“ç­‰ï¼Œå¯¹ä¸Šå±‚ä¸šåŠ¡å®ç°æ˜¯æ„ŸçŸ¥ä¸åˆ°çš„ã€‚é€šè¿‡æŠ½è±¡æ¥å£ï¼Œåè½¬ä¾èµ–ã€‚</li>
</ul>

<h4 id="5-é‡Œæ°æ›¿æ¢åŸåˆ™">5. é‡Œæ°æ›¿æ¢åŸåˆ™</h4>
<ul>
  <li>çˆ¶ç±»å¯ä»¥è¢«å­ç±»æ— ç¼æ›¿æ¢ï¼Œä¸”åŸæœ‰åŠŸèƒ½ä¸å—ä»»ä½•å½±å“ã€‚</li>
  <li>å¦‚ï¼šKVOå®ç°åŸç†ï¼Œå½“è°ƒç”¨addObserveræ–¹æ³•æ—¶ï¼Œç³»ç»Ÿå¯¹åŠ¨æ€è¿è¡Œæ—¶åˆ›å»ºå­ç±»ï¼Œä½¿ç”¨çš„ç±»è¢«ç³»ç»Ÿæ— æ„Ÿæ›¿æ¢æˆå­ç±»ã€‚</li>
</ul>

<h4 id="6-è¿ªç±³ç‰¹æ³•åˆ™">6. è¿ªç±³ç‰¹æ³•åˆ™</h4>
<ul>
  <li>ä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡æœ‰å°½å¯èƒ½å°‘çš„äº†è§£</li>
  <li>é«˜å†…èšã€ä½è€¦åˆ</li>
</ul>

<h3 id="äºŒäº”å¤§è®¾è®¡æ¨¡å¼">äºŒã€äº”å¤§è®¾è®¡æ¨¡å¼</h3>
<h4 id="1-è´£ä»»é“¾">1. è´£ä»»é“¾</h4>
<ul>
  <li>ä¸€ä¸ªå…³äºéœ€æ±‚å˜æ›´çš„é—®é¢˜
<img src="http://files.pandaleo.cn/d17f04e8013182603a8b798b15867521.png?imageMogr2/thumbnail/!68p" alt="" />
<img src="http://files.pandaleo.cn/560646087b2926a195e215037e33f5bf.png?imageMogr2/thumbnail/!68p" alt="" /></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// BusinessObject.h
#import &lt;Foundation/Foundation.h&gt;
@class BusineessObject;
typedef void(^CompletionBlock)(BOOL handled);
typedef void(^ResultBlock)(BusinessObject *handler, BOOL handled);

@interface BusinessObject : NSObject

// ä¸‹ä¸€ä¸ªå“åº”è€…ï¼ˆå“åº”é“¾æ„æˆçš„å…³é”®ï¼‰
@property (nonatomic, strong) BusinessObject *nextBusiness;
// å“åº”è€…çš„å¤„ç†æ–¹æ³•
// å…¥å£/èŠ‚ç‚¹å‡½æ•°
- (void)handle:(ResultBlock)result;

// å„ä¸ªä¸šåŠ¡åœ¨è¯¥æ–¹æ³•å½“ä¸­åšå®é™…ä¸šåŠ¡å¤„ç†
// Blockåœ¨ä¸šåŠ¡æ¶‰åŠåˆ°å¼‚æ­¥ç½‘ç»œè¯·æ±‚ï¼Œå¦‚å›¾ç‰‡æŸ¥è¯¢æ“ä½œé€»è¾‘æ—¶ä½¿ç”¨
- (void)handleBusiness:(CompletionBlock)completion;
@end

# import â€œBusinessObject.hâ€
@implementation BusinessObject

// è´£ä»»é“¾å…¥å£æ–¹æ³•
- (void)handle:(ResultBlock)result
{
    CompletionBlock completion = ^(BOOL handled) {
        // å½“å‰ä¸šåŠ¡å¤„ç†æ‰äº†ï¼Œä¸ŠæŠ›ç»“æœ
        if (handled) {
            result(self, handled);
        }
        else {
            // æ²¿ç€è´£ä»»é“¾ï¼ŒæŒ‡æ´¾ç»™ä¸‹ä¸€ä¸ªä¸šåŠ¡å¤„ç†
            if (self.nextBusiness) {
                [self.nextBusiness handle:result];
            }
            else {
                // æ‰¾åˆ°è´£ä»»é“¾æœ«å°¾ï¼Œæ²¡æœ‰ä¸šåŠ¡å¤„ç†ï¼Œä¸ŠæŠ›
                result(nil, NO);
            }
        }
    }

    // å½“å‰ä¸šåŠ¡å¤„ç†
    [self handleBusiness:completion];
}

- (void)handleBusiness:(CompletionBlock)completion
{
    /*
    ä¸šåŠ¡é€»è¾‘å¤„ç†
    å¦‚ç½‘ç»œè¯·æ±‚ã€æœ¬åœ°å›¾åº“æŸ¥è¯¢ç­‰
    */

}

@end
</code></pre></div></div>
<ul>
  <li>è§£å†³æ–¹æ¡ˆï¼š
<img src="http://files.pandaleo.cn/a5989905206d172b41eca9029cc5628d.png?imageMogr2/thumbnail/!68p" alt="" />
    <ul>
      <li>è°ƒæ•´ä¼˜å…ˆçº§æ—¶ï¼Œåªéœ€è¦è°ƒæ•´å¯¹åº”nextResponderæŒ‡å‘ï¼Œæˆ–æ”¹ä¸ºServeråŠ¨æ€ä¸‹å‘</li>
      <li>å®ç°ä¸šåŠ¡éœ€æ±‚çš„åŠ¨æ€è°ƒæ•´ï¼š
        <ul>
          <li>ä¸ºä¸šåŠ¡å®šä¹‰ä¸šåŠ¡å·ï¼Œæ¯ä¸ªä¸šåŠ¡å·å¯¹åº”ç±»ã€‚</li>
          <li>å°†å¯¹åº”å…³ç³»åˆ¶ä½œæˆplistæ–‡ä»¶ï¼Œé€šè¿‡æœåŠ¡ç«¯ä¸‹å‘ï¼Œè°ƒæ•´ç›¸åº”é¡ºåºã€‚</li>
          <li>é€šè¿‡ä»£ç çš„classåå°„ï¼Œè§£æå¯¹åº”ç±»ï¼ŒæŒ‰æ•°ç»„é¡ºåºåˆ¶å®šä¸‹ä¸€å“åº”è€…ã€‚</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="2-æ¡¥æ¥">2. æ¡¥æ¥</h4>
<ul>
  <li>ä¸€ä¸ªå…³äºä¸šåŠ¡è§£è€¦çš„é—®é¢˜
<img src="http://files.pandaleo.cn/709a5acca7a41cc343f782f6db6a1961.png?imageMogr2/thumbnail/!68p" alt="" /></li>
  <li>ç±»æ„æˆ
<img src="http://files.pandaleo.cn/e33df49f378015a0602b64df232ec9ba.png?imageMogr2/thumbnail/!68p" alt="" /></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// æ¡¥æ¥A
@interface BaseObjectA : NSObject

// æ¡¥æ¥æ¨¡å¼çš„æ ¸å¿ƒå®ç°
@property (nonatomic, strong) BaseObjectB *objB;

// è·å–æ•°æ®
- (void)handle;

@end

@implementation BaseObjectA

/*
    A1 â€”&gt; B1ã€B2ã€B3   3ç§
    A2 â€”&gt; B1ã€B2ã€B3   3ç§
    A3 â€”&gt; B1ã€B2ã€B3   3ç§
*/

- (void)handle
{
    // override to subclass
    [self.objB fetchData];
}

@implementation ObjectA1

- (void)handle
{
    // before ä¸šåŠ¡é€»è¾‘æ“ä½œ

    [super handle];

    // after ä¸šåŠ¡é€»è¾‘æ“ä½œ
}

@end

// æ¡¥æ¥B
@interface BaseObjectB : NSObject

- (void)fetchData;

@end

@implementation BaseObjectB

- (void)fetchData
{
    // override to subclass
    // æŠ½è±¡ç±»ï¼Œæä¾›æœåŠ¡
}

@end

@interface BaseObjectB1 : NSObject

@end

@implementation ObjectB1

- (void)fetchData {
    // å…·ä½“çš„é€»è¾‘å¤„ç†
}
@end

// æ¡¥æ¥æ¨¡å¼é€‚ç”¨æˆ¿
@interface BridgeDemo()
@property (nonatomic, strong) BaseObjectA *objA;
@end

@implentation BridgeDemo

/*
    æ ¹æ®å®é™…ä¸šåŠ¡åˆ¤æ–­ä½¿ç”¨å“ªå¥—å…·ä½“æ•°æ®
    A1 â€”&gt; B1ã€B2ã€B3   3ç§
    A2 â€”&gt; B1ã€B2ã€B3   3ç§
    A3 â€”&gt; B1ã€B2ã€B3   3ç§
*/

- (void)fetch
{
    // åˆ›å»ºä¸€ä¸ªå…·ä½“ClassA
    _objA = [[ObjectA1 alloc] init];

    // åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ClassB
    BaseObjectB *b1 = [[ObjectB1 alloc] init];
    // å°†ä¸€ä¸ªå…·ä½“çš„ClassB1 æŒ‡å®šç»™æŠ½è±¡çš„ClassB
    _objA.objB = b1;

    // è·å–æ•°æ®
    [_objA handle];
}
</code></pre></div></div>
<ul>
  <li>åº”ç”¨åœºæ™¯ï¼šç½‘ç»œè¯·æ±‚æ—¶ï¼Œä½¿ç”¨ä¸åŒçš„æ¥å£è¯·æ±‚å‚æ•°ï¼Œè¿”å›ä¸åŒçš„å¯¹è±¡æ¨¡å‹</li>
</ul>

<h4 id="3-é€‚é…å™¨">3. é€‚é…å™¨</h4>
<ul>
  <li>ä¸€ä¸ªç°æœ‰ç±»éœ€è¦é€‚åº”å˜åŒ–çš„é—®é¢˜</li>
  <li>æ–‡ä»¶äº§ç”Ÿå·²ä¹…ï¼Œç»è¿‡éœ€æ±‚è¿­ä»£ç±»æ–‡ä»¶æ¯”è¾ƒæˆç†Ÿå’Œç¨³å®šï¼Œå¯¹ç±»æˆå‘˜å˜é‡å’Œæ–¹æ³•ä¿®æ”¹æ—¶é£é™©å¾ˆå¤§ã€‚</li>
  <li>å¯¹è±¡é€‚é…å™¨
<img src="http://files.pandaleo.cn/52d9eb4f79a8635df69571d6bde9bd58.png?imageMogr2/thumbnail/!68p" alt="" /></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (void)request {
    // é€‚é…é€»è¾‘
    [è¢«é€‚é…å¯¹è±¡ æŸæ–¹æ³•];
    // é€‚é…é€»è¾‘
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// å…·ä½“å®ç°

// è¢«é€‚é…å¯¹è±¡
@interface Target : Object

- (void)operation;

@end

@implementation Target

- (void)operation
{
    // åŸæœ‰çš„å…·ä½“ä¸šåŠ¡é€»è¾‘
}

@end

// é€‚é…å¯¹è±¡
@interface CoolTarget : Object

// è¢«é€‚é…å¯¹è±¡
@property (nonatomic, strong) Target *target;

// å¯¹åŸæœ‰æ–¹æ³•åŒ…è£…
- (void)request;

@end


@implementation CoolTarget


- (void)request
{
    // é¢å¤–å¤„ç†
    [self.target operation];
    // é¢å¤–å¤„ç†
}


@end
</code></pre></div></div>
<ul>
  <li>ç±»é€‚é…å™¨</li>
</ul>

<h4 id="4-å•ä¾‹">4. å•ä¾‹</h4>
<ul>
  <li>å¯èƒ½ç”¨çš„å¹¶ä¸æ­£ç¡®</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@implementation Panda

+ (id)sharedInstance
{
    // é™æ€å±€éƒ¨å˜é‡
    static Panda *instance = nil;

    // é€šè¿‡dispatch_onceæ–¹å¼ï¼Œç¡®ä¿instanceåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åªè¢«åˆ›å»ºä¸€æ¬¡
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        // åˆ›å»ºå®ä¾‹
        // æ³¨æ„1ï¼šé‡å†™allocWithZoneæ—¶ï¼Œä¼šè°ƒç”¨selfçš„sharedInstanceï¼Œå¦‚æœä½¿ç”¨selfçš„allocWithZoneæ—¶ï¼Œåˆå§‹åŒ–ä¼šå¼•èµ·å¾ªç¯è°ƒç”¨ã€‚
        instance = [[super allocWithZone:NULL] init];
    });
    return instance;
}

// æ³¨æ„2ï¼šé‡å†™æ–¹æ³•ã€å¿…ä¸å¯å°‘ã€‘ï¼Œä¸é€šè¿‡sharedInstanceåˆ›å»ºæ–¹æ³•æ—¶ï¼Œå¦‚alloc initã€‚
+ (id)allocWithZone:(struct _NSZone *)zone{
    return [self sharedInstance];
}

// æ³¨æ„3ï¼šé‡å†™æ–¹æ³•ã€å¿…ä¸å¯å°‘ã€‘ï¼Œé€šè¿‡å¯¹å½“å‰å®ä¾‹é€šè¿‡copyæ“ä½œåˆ›å»ºã€‚
+ (id)copyWithZone:(nullable NSZone *)zone{
    return self;
}
</code></pre></div></div>

<h4 id="5-å‘½ä»¤">5. å‘½ä»¤</h4>
<ul>
  <li>è¡Œä¸ºå‚æ•°åŒ–ï¼Œå®šä¹‰</li>
  <li>é™ä½ä»£ç é‡åˆåº¦ï¼Œä½œç”¨</li>
  <li>å¦‚ï¼šå¾®åšï¼Œè½¬å‘ã€è¯„è®ºã€èµï¼Œåœ¨ä¸åŒé¡µé¢äº§ç”Ÿè¡Œä¸ºï¼Œå°è£…æˆè¡Œä¸ºå‚æ•°åŒ–å½¢å¼ï¼Œæ‰§è¡Œå‘½ä»¤</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@class Command;
typedef void(^CommandCompletionCallBack)(Command* cmd);

@interface Command : NSObject
@property (nonatomic, copy) CommandCompletionCallBack completon;

- (void)execute;
- (void)cancel;
- (void)done;

@end

@inplementation Command

- (void)execute {

    // override to subclass;

    [self done];

}

- (void)cancel {

    self.completion = nil;
}

- (void)done {

    // ä¸èƒ½ç¡®å®šå‘½ä»¤æ˜¯å¦åœ¨å­çº¿ç¨‹ï¼Œéœ€è¦å¼‚æ­¥å›åˆ°ä¸»é˜Ÿåˆ—é€šçŸ¥è°ƒç”¨æ–¹
    dispatch_async(dispatch_get_main_queue(), ^{

        if (_completion) {
            _completion(self);
        }

        // é‡Šæ”¾
        self.cmpletion = nil;

        [[CommandManager shareInstance].arrayCommands removeObject:self];

    });

}

@end

// å‘½ä»¤ç®¡ç†è€…
@interface CommandManager : NSObject

// å‘½ä»¤ç®¡ç†å®¹å™¨
@property (nonatomic, strong) NSMutableArray &lt;Command*&gt; *arrayCommands;

// å‘½ä»¤ç®¡ç†è€…ä»¥å•ä¾‹æ–¹å¼å‘ˆç°
+ (instancetype)sharedInstance;

// æ‰§è¡Œå‘½ä»¤
+ (void)executeCommand:(Command *)cmd completion: (CommandCompletionCallBack)completion;

// å–æ¶ˆå‘½ä»¤
+ (void)cancelCommand:(Command *)cmd;

@end

@implementation CommandManager

+ (instancetype)sharedInstance
{
    static CommandManager *instance = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        instance = [[super allocWithZone:NULL] init];
    });
    return instance;
}

+ (id)allocWithZone:(struct _NSZone *)zone{
    return [self sharedInstance];
}

+ (id)copyWithZone:(nullable NSZone *)zone{
    return self;
}

+ (void)executeCommand:(Command *)cmd completion: (CommandCompletionCallBack)completion
{
    if(cmd) {
        // å¦‚æœå‘½ä»¤æ­£åœ¨æ‰§è¡Œä¸åšå¤„ç†ï¼Œå¦åˆ™æ·»åŠ å¹¶æ‰§è¡Œå‘½ä»¤
        if (![self _isExecutingCommand:cmd]) {
            // æ·»åŠ åˆ°å‘½ä»¤å®¹å™¨å½“ä¸­
            [[self sharedInstance] arrayCommands] addObject:cmd];
            // è®¾ç½®å‘½ä»¤æ‰§è¡Œå®Œæˆçš„å›è°ƒ
            cmd.completion = completion;
            // æ‰§è¡Œå‘½ä»¤
            [cmd execute];
        }
    }
}

+ (void)cancelCommand:(Command *)cmd
{
    if (cmd) {
        // ä»å‘½ä»¤å®¹å™¨å½“ä¸­ç§»é™¤
        [[self sharedInstance] arrayCommands] removeObject:cmd];
        // å–æ¶ˆå‘½ä»¤æ‰§è¡Œ
        [cmd cancel];
    }
}

// åˆ¤æ–­å½“å‰å‘½ä»¤æ˜¯å¦æ­£åœ¨æ‰§è¡Œ
+ (BOOL)_isExecuingCommand:(Command *)cmd
{
    if (cmd) {
        NSArray *cmds = [[self sharedInstance] arrayCommands];
        for (Command *aCmd in cmds) {
            // å½“å‰å‘½ä»¤æ­£åœ¨æ‰§è¡Œ
            if (cmd == aCmd) {
                return YES;
            }
        }
    }
}
</code></pre></div></div>
:ET