I"ƒ`<h3 id="ä¸€å“¨å²—å€¼">ä¸€ã€å“¨å²—å€¼</h3>
<p>åœ¨ç¼–ç¨‹ä¸–ç•Œä¸­æœ‰ä¸€ç§éå¸¸é€šç”¨çš„æ¨¡å¼ï¼Œé‚£å°±æ˜¯æŸä¸ªæ“ä½œæ˜¯å¦è¦è¿”å›ä¸€ä¸ªæœ‰æ•ˆå€¼ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Cã€‚EOF åªæ˜¯å¯¹äº -1 çš„ä¸€ä¸ª #define
int ch;
while ((ch = getchar()) != EOF) {
  printf("Read character %c\n", ch);
}
printf("Reached end-of-file\n");

// C++ã€‚vec.end() æ˜¯å®¹å™¨çš„â€œæœ«å°¾å†è¶…ä¸€ä½â€çš„è¿­ä»£å™¨ã€‚
auto vec = {1, 2, 3};
auto iterator = std::find(vec.begin(), vec.end(), someValue);
if (iterator != vec.end()) {
  std::cout &lt;&lt; "vec contains " &lt;&lt; *iterator &lt;&lt; std::endl;
}

// Java ä»£ç å°±å°†æŠ›å‡ºä¸€ä¸ª NullPointerException
int i = Integer.getInteger("123")

// OCã€‚NSString æœ‰å¯èƒ½æ˜¯ nil
[[NSString alloc] initWithContentsOfURL:url
encoding:NSUTF8StringEncoding error:&amp;e];

// Objective-C åœ¨è¿è¡Œæ—¶ä¼šä¿è¯å‘ nil å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿”å›å€¼æ€»æ˜¯ç­‰ä»·äº 0
// å¦‚æœ someString æ˜¯ nilï¼Œè¿”å›ä¸ºé›¶çš„ NSRangeï¼Œè€Œ NSNotFound è¢«å®šä¹‰ä¸º NSIntegerMaxï¼Œif è¯­å¥çš„å†…å®¹å°†è¢«æ‰§è¡Œã€‚
NSString *someString = ...;
if ([someString rangeOfString:@"Swift"].location != NSNotFound) {
  NSLog(@"Someone mentioned Swift!");
}
</code></pre></div></div>
<ul>
  <li>è¿™äº›å‡½æ•°éƒ½è¿”å›äº†ä¸€ä¸ªâ€œé­”æ³•â€æ•°æ¥è¡¨ç¤ºå‡½æ•°å¹¶æ²¡æœ‰è¿”å›çœŸå®çš„å€¼ã€‚è¿™æ ·çš„å€¼è¢«ç§°ä¸ºâ€œå“¨å²—å€¼â€ã€‚</li>
  <li>å“¨å²—å€¼å¾ˆå®¹æ˜“äº§ç”Ÿé—®é¢˜ï¼Œå› ä¸ºä½ å¯èƒ½ä¼šå¿˜è®°æ£€æŸ¥å“¨å²—å€¼ï¼Œå¹¶ä¸”ä¼šä¸å°å¿ƒä½¿ç”¨å®ƒä»¬ã€‚</li>
</ul>

<h3 id="äºŒé€šè¿‡æšä¸¾è§£å†³é­”æ³•æ•°çš„é—®é¢˜">äºŒã€é€šè¿‡æšä¸¾è§£å†³é­”æ³•æ•°çš„é—®é¢˜</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>enum Optional&lt;Wrapped&gt; {
  case none
  case some(Wrapped)
}
</code></pre></div></div>
<ul>
  <li>æšä¸¾å«æœ‰â€œå…³è”å€¼â€çš„æ¦‚å¿µï¼Œå¯ä»¥åœ¨ä»–ä»¬çš„å€¼ä¸­åŒ…å«å¦å¤–çš„å…³è”çš„å€¼ã€‚</li>
  <li>æ ‡ç­¾è”åˆï¼Œå°†è‹¥å¹²ä¸åŒçš„å¯èƒ½ç±»å‹ä¿å­˜åœ¨å†…å­˜çš„åŒä¸€ç©ºé—´ä¸­ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªæ ‡ç­¾æ¥åŒºåˆ†åˆ°åº•è¢«æŒæœ‰çš„æ˜¯ä»€ä¹ˆç±»å‹ã€‚åœ¨Swiftæšä¸¾ä¸­ï¼Œæšä¸¾çš„caseå°±æ˜¯æ ‡ç­¾ã€‚</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Swift ä¸­ä¸ find ç­‰æ•ˆçš„æ–¹æ³• index(of:) æ‰€è¿”å›çš„ä¸æ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ª Optional&lt;Index&gt;ã€‚
extension Collection where Element: Equatable {
  func index(of element: Element) -&gt; Optional&lt;Index&gt; {
    var idx = startIndex
    while idx != endIndex {
      if self[idx] == element {
        return .some(idx)
      }
      formIndex(after: &amp;idx)
    }
    // æ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å› .none
    return .none
  }
}

var array = ["one", "two", "three"]
let idx = array.index(of: "four")
// ç¼–è¯‘é”™è¯¯ï¼šremove(at:) æ¥å— Intï¼Œè€Œä¸æ˜¯ Optional&lt;Int&gt;
array.remove(at: idx)

var array = ["one","two","three"]
switch array.index(of: "four") {
  case .some(let idx):
    array.remove(at: idx)
  case .none:
    break // ä»€ä¹ˆéƒ½ä¸åš
}

switch array.index(of: "four") {
  case let idx?:
    array.remove(at: idx)
  case nil:
    break // ä»€ä¹ˆéƒ½ä¸åš
}
</code></pre></div></div>

<h3 id="ä¸‰å¯é€‰å€¼æ¦‚è§ˆ">ä¸‰ã€å¯é€‰å€¼æ¦‚è§ˆ</h3>
<h4 id="1-if-let">1. if let</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var array = ["one", "two", "three", "four"]
if let idx = array.index(of: "four") {
  array.remove(at: idx)
}

// å¯é€‰ç»‘å®šå’Œä¸€ä¸ªå¸ƒå°”é™å®šè¯­å¥æ­é…
if let idx = array.index(of: "four"), idx != array.startIndex {
  array.remove(at: idx)
}

// åŒä¸€ä¸ª if è¯­å¥ä¸­ç»‘å®šå¤šä¸ªå€¼ï¼Œåé¢çš„ç»‘å®šå€¼å¯ä»¥åŸºäºä¹‹å‰çš„æˆåŠŸè§£åŒ…çš„å€¼æ¥è¿›è¡Œæ“ä½œ
let urlString = "https://www.objc.io/logo.png"
if let url = URL(string: urlString),
let data = try? Data(contentsOf: url),
let image = UIImage(data: data)
{
  let view = UIImageView(image: image)
  PlaygroundPage.current.liveView = view
}

// å¤šä¸ª let çš„ä»»æ„éƒ¨åˆ†ä¹Ÿèƒ½æ‹¥æœ‰å¸ƒå°”å€¼é™å®šçš„è¯­å¥
if let url = URL(string: urlString), url.pathExtension == "png",
let data = try? Data(contentsOf: url),
let image = UIImage(data: data)
{
  let view = UIImageView(image: image)
}

// ä¸º if æä¾›ä¸€ä¸ªå‰ç½®çš„æ¡ä»¶
if segue.identifier == "showUserDetailsSegue",
let userDetailVC = segue.destination
as? UserDetailViewController
{
  userDetailVC.screenName = "Hello"
}

// ä¸Foundation æ¡†æ¶çš„ Scanner ç±»å‹æ­é…ä½¿ç”¨
let scanner = Scanner(string: "lisa123")
var username: NSString?
let alphas = CharacterSet.alphanumerics
if scanner.scanCharacters(from: alphas, into: &amp;username),
let name = username {
  print(name)
}

</code></pre></div></div>
<h4 id="2-while-let">2. while let</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Unix ä¸­ cat å‘½ä»¤ç­‰ä»·çš„å‡½æ•°
while let line = readLine() {
  print(line)
}

// é‡åˆ° EOF æˆ–è€…ç©ºè¡Œçš„æ—¶å€™ç»ˆæ­¢å¾ªç¯
while let line = readLine(), !line.isEmpty {
  print(line)
}

// ç”¨äº makeIterator æ–¹æ³•æ¥åˆ›å»ºçš„è¿­ä»£å™¨
let array = [1, 2, 3]
var iterator = array.makeIterator()
while let i = iterator.next() {
  print(i, terminator: " ")
} // 1 2 3

for i in 0..&lt;10 where i % 2 == 0 {
  print(i, terminator: " ")
} // 0 2 4 6 8

var iterator2 = (0..&lt;10).makeIterator()
  while let i = iterator.next() {
  if i % 2 == 0 {
    print(i)
  }
}

// Rubyé”™è¯¯ç”¨æ³•
// æ‰“å°ä¸‰ä¸ª3ï¼Œé—­åŒ…è¡¥è·äº†åŒä¸€ä¸ªiå˜é‡
functions = []
for i in 1..3
  functions.push(lambda { i })
end
for f in functions
  print "#{f.call()} "
end

// Rubyæ‰§è¡Œåˆ†æï¼Œiåœ¨å¾ªç¯å¤–éƒ¨ï¼Œè¢«é‡ç”¨
// doè®©è¿™ä¸ªå˜é‡åœ¨æ•´ä¸ªå¾ªç¯å¤–éƒ¨ä¸è¢«è®¿é—®åˆ°ï¼Œå¤¹åœ¨å†…éƒ¨å’Œå¤–éƒ¨ä¹‹é—´
var functions2: [() -&gt; Int] = []
do {
  var iterator2 = (1...3).makeIterator()
  var i: Int
  var current: Int? = iterator2.next()
  while current != nil {
    i = current!
    functions2.append { i }
    current = iterator2.next()
  }
}

// Swiftåœ¨ä½œç”¨åŸŸå†…é‡æ–°èµ‹å€¼
var functions: [() -&gt; Int] = []
for i in 1...3 {
  functions.append { i }
}
for f in functions {
  print("\(f())", terminator: " ")
} // 1 2 3

// Swiftæ‰§è¡Œåˆ†æ
var functions1: [() -&gt; Int] = []
var iterator1 = (1...3).makeIterator()
var current1: Int? = iterator1.next()
while current1 != nil {
  let i = current1!
  functions1.append { i }
  nctions1.append { i }
  current1 = iterator1.next()
}
</code></pre></div></div>
<h4 id="3-åŒé‡å¯é€‰å€¼">3. åŒé‡å¯é€‰å€¼</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// å¯é€‰å€¼åµŒå¥—åœ¨å¯é€‰å€¼ä¸­
let stringNumbers = ["1", "2", "three"]
let maybeInts = stringNumbers.map { Int($0) } // [Optional(1), Optional(2), nil]

for maybeInt in maybeInts {
  // maybeInt æ˜¯ä¸€ä¸ª Int? å€¼
  // å¾—åˆ°ä¸¤ä¸ªæ•´æ•°å€¼å’Œä¸€ä¸ª `nil`
}

// iterator.next() è¿”å› Optional&lt;Optional&lt;Int&gt;&gt; å€¼
var iterator = maybeInts.makeIterator()
while let maybeInt = iterator.next() {
  print(maybeInt, terminator: " ")
}
// Optional(1) Optional(2) nil

// ä½¿ç”¨caseåŒ¹é…æ¨¡å¼ï¼Œå¯¹énilçš„å€¼åšforå¾ªç¯
for case let i? in maybeInts {
// i å°†æ˜¯ Int å€¼ï¼Œè€Œä¸æ˜¯ Int?
  print(i, terminator: " ")
}
// 1 2
// æˆ–è€…åªå¯¹ nil å€¼è¿›è¡Œå¾ªç¯
for case nil in maybeInts {
  // å°†å¯¹æ¯ä¸ª nil æ‰§è¡Œä¸€æ¬¡
  print("No value")
}
// No value

for case let .some(i) in maybeInts {
  print(i)
}

// å°†switchçš„åŒ¹é…æ¨¡å¼ç”¨åœ¨å¾ªç¯å’Œåˆ¤æ–­ä¸­
let j = 5
if case 0..&lt;10 = j {
  print("\(j) åœ¨èŒƒå›´å†…")
} // 5 åœ¨èŒƒå›´å†…

// case åŒ¹é…é€šè¿‡é‡è½½ ~= è¿ç®—ç¬¦æ‰©å±•
struct Pattern {
  let s: String
  init(_ s: String) { self.s = s }
}
func ~=(pattern: Pattern, value: String) -&gt; Bool {
  return value.range(of: pattern.s) != nil
}

let s = "Taylor Swift"
if case Pattern("Swift") = s {
  print("\(String(reflecting: s)) contains \"Swift\"")
}
// "Taylor Swift" contains "Swift

// å¤§å‘ï¼é™¤éè¿˜å®šä¹‰äº†æ›´ç²¾ç¡®çš„ç‰ˆæœ¬ï¼Œå¦åˆ™è¿™æ®µä»£ç å°†ä¼šä½¿æ‰€æœ‰æƒ…å½¢éƒ½åŒ¹é…ã€‚
func ~=&lt;T, U&gt;(_: T, _: U) -&gt; Bool { return true }
</code></pre></div></div>
<h4 id="4-if-var-and-while-var">4. if var and while var</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// iæ˜¯æœ¬åœ°çš„å¤åˆ¶ï¼Œä¸æ”¹å˜åŸå€¼
let number = "1"
if var i = Int(number) {
    i += 1
    print(i)
} // 2
</code></pre></div></div>
<h4 id="5-è§£åŒ…åå¯é€‰å€¼çš„ä½œç”¨åŸŸ">5. è§£åŒ…åå¯é€‰å€¼çš„ä½œç”¨åŸŸ</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let array = [1,2,3]
if !array.isEmpty {
  print(array[0])
}
// if å—çš„å¤–éƒ¨ï¼Œç¼–è¯‘å™¨æ— æ³•ä¿è¯ a[0] çš„æœ‰æ•ˆæ€§

if let firstElement = array.first {
  print(firstElement)
}
// if å—çš„å¤–éƒ¨ï¼Œä¸èƒ½ä½¿ç”¨ firstElement

func doStuff(withArray a: [Int]) {
  if a.isEmpty {
    return
  }
  // ç°åœ¨å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ a[0]
}

extension String {
  var fileExtension: String? {
    let period: String.Index
    if let idx = index(of: ".") {
      period = idx
    } else {
      return nil
    }
    let extensionStart = index(after: period)
    return String(self[extensionStart...])
  }
}
"hello.txt".fileExtension // Optional("txt")
// ifè¯­å¥åï¼Œä»£ç å¯ä»¥éšæ„ä½¿ç”¨periodï¼Œä¸éœ€è¦è€ƒè™‘å¯é€‰å€¼çš„å¯èƒ½æ€§ã€‚

func doStuff(withArray a: [Int]) {
  guard let firstElement = a.first else {
    return
  }
  // firstElement is unwrapped here
}

extension String {
  var fileExtension: String? {
    guard let period = index(of: ".") else {
      return nil
    }
    let extensionStart = index(after: period)
    return String(self[extensionStart...])
  }
}
// guardçš„elseå¯ä»¥åšä»»ä½•äº‹ï¼ŒåŒ…æ‹¬æ‰§è¡Œå¤šå¥ä»£ç ã€‚å¿…é¡»åœ¨elseä¸­ç¦»å¼€å½“å‰ä½œç”¨åŸŸï¼Œreturnæˆ–è°ƒç”¨fatalErrorï¼ˆæˆ–å…¶ä»–è¿”å›Neverçš„æ–¹æ³•ï¼‰ã€‚å¾ªç¯ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨breakæˆ–continueã€‚

// guardå¯ä»¥æ¥å—ifæ¡ä»¶ï¼Œå•ä½¿ç”¨å•°å—¦ï¼Œä¸æ¸…æ™°ã€‚
func doStuff2(withArray a: [Int]) {
  guard !a.isEmpty else { return }
  // ç°åœ¨å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ a[0] æˆ– a.first! äº†
}
</code></pre></div></div>
<h4 id="6-å¯é€‰é“¾">6. å¯é€‰é“¾</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// å¯é€‰é“¾ï¼Œæ–¹æ³•å¯èƒ½ä¼šä¸è¢«è°ƒç”¨
delegate?.callback()

let str: String? = "Never say never"
// æˆ‘ä»¬å¸Œæœ› upper æ˜¯å¤§å†™çš„å­—ç¬¦ä¸²
let upper: String
if str != nil {
  upper = str!.uppercased()
} else {
  // è¿™é‡Œæ²¡æœ‰åˆç†çš„å¤„ç†æ–¹æ³•
  fatalError("no idea what to do now...")
}

let result = str?.uppercased() // Optional("NEVER SAY NEVER")
let lower = str?.uppercased().lowercased() // Optional("never say never")
// å¯é€‰é“¾â€å±•è¯„æ“ä½œâ€ã€‚

// é™¤2ï¼Œä¸å¤Ÿ2å¤§è¿”å›nil
extension Int {
  var half: Int? {
    guard self &lt; -1 || self &gt; 1 else { return nil }
    return self / 2
  }
}
// éƒ½æœ‰å¯èƒ½è¿”å›å¯é€‰ç»“æœ
20.half?.half?.half // Optional(2)

let dictOfArrays = ["nine": [0, 1, 2, 3]]
dictOfArrays["nine"]?[3] // Optional(3)

let dictOfFunctions: [String: (Int, Int) -&gt; Int] = [
  "add": (+),
  "subtract": (-)
]
dictOfFunctions["add"]?(1, 1) // Optional(2)

class TextField {
  private(set) var text = ""
  var didChange: ((String) -&gt; ())?
  private func textDidChange(newText: String) {
    text = newText
    // å¦‚æœä¸æ˜¯ nil çš„è¯ï¼Œè§¦å‘å›è°ƒ
    didChange?(text)
  }
}
// æ³¨å†Œå›è°ƒæ—¶è°ƒç”¨ï¼Œéå¸¸ç®€æ´ã€‚

struct Person {
  var name: String
  var age: Int
}
var optionalLisa: Person? = Person(name: "Lisa Simpson", age: 8)
  // å¦‚æœä¸æ˜¯ nilï¼Œåˆ™å¢åŠ 
  if optionalLisa != nil {
  optionalLisa!.age += 1
}
// ä¸Šé¢ä¸‘é™‹ï¼Œä¸‹é¢å€¼å¤åˆ¶ï¼Œä¸æ”¹å˜åŸæ•°æ®
if var lisa = optionalLisa {
  // å¯¹ lisa çš„å˜æ›´ä¸ä¼šæ”¹å˜ optionalLisa ä¸­çš„å±æ€§
  lisa.age += 1
}
// ç®€æ´
optionalLisa?.age += 1

var a: Int? = 5
a? = 10 // èµ‹å€¼å‘ç”Ÿå‰ä¸æ˜¯ nil
a // Optional(10)
var b: Int? = nil
b? = 10
b // nil
</code></pre></div></div>
<h4 id="7-nil-åˆå¹¶è¿ç®—ç¬¦">7. nil åˆå¹¶è¿ç®—ç¬¦</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let stringteger = "1"
let number = Int(stringteger) ?? 0
// lhs != nil ? lhs! : rhs

let array = [1,2,3]
!array.isEmpty ? array[0] : 0
array.first ?? 0 // 1

array.count &gt; 5 ? array[5] : 0 // 0

extension Array {
  subscript(guarded idx: Int) -&gt; Element? {
    guard (startIndex..&lt;endIndex).contains(idx) else {
      return nil
    }
    return self[idx]
  }
}
// ç®€å†™æˆ
array[guarded: 5] ?? 0 // 0

let i: Int? = nil
let j: Int? = nil
let k: Int? = 42
i ?? j ?? k ?? 0 // 42

let m = i ?? j ?? k
type(of: m) // Optional&lt;Int&gt;

if let n = i ?? j {
  // å’Œ if i != nil || j != nil ç±»ä¼¼
  print(n)
}

if let n = i, let m = j { }
// å’Œ if i != nil &amp;&amp; j != nil ç±»ä¼¼

let s1: String?? = nil // nil
(s1 ?? "inner") ?? "outer" // inner
let s2: String?? = .some(nil) // Optional(nil)
(s2 ?? "inner") ?? "outer" // outer
</code></pre></div></div>
<h4 id="8-åœ¨å­—ç¬¦ä¸²æ’å€¼ä¸­ä½¿ç”¨å¯é€‰å€¼">8. åœ¨å­—ç¬¦ä¸²æ’å€¼ä¸­ä½¿ç”¨å¯é€‰å€¼</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let bodyTemperature: Double? = 37.0
let bloodGlucose: Double? = nil
print(bodyTemperature) // Optional(37.0)
// è­¦å‘Šï¼šè¡¨è¾¾å¼è¢«éšå¼å¼ºåˆ¶ä» 'Double?' è½¬æ¢ä¸º Any
print("Blood glucose level: \(bloodGlucose)") // Blood glucose level: nil
// è­¦å‘Šï¼šå­—ç¬¦ä¸²æ’å€¼å°†ä½¿ç”¨è°ƒè¯•æ—¶çš„å¯é€‰å€¼æè¿°ï¼Œ
// è¯·ç¡®è®¤è¿™æ˜¯ç¡®å®æ˜¯ä½ æƒ³è¦åšçš„ã€‚

infix operator ???: NilCoalescingPrecedence
public func ???&lt;T&gt;(optional: T?, defaultValue: @autoclosure () -&gt; String)
-&gt; String
{
  switch optional {
    case let value?: return String(describing: value)
    case nil: return defaultValue()
  }
}

print("Body temperature: \(bodyTemperature ??? "n/a")")
// Body temperature: 37.0
print("Blood glucose level: \(bloodGlucose ??? "n/a")")
// Blood glucose level: n/a
</code></pre></div></div>
<h4 id="9-å¯é€‰å€¼-map">9. å¯é€‰å€¼ map</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let characters: [Character] = ["a", "b", "c"]
String(characters[0]) // a

var firstCharAsString: String? = nil
if let char = characters.first {
  firstCharAsString = String(char)
}

let firstChar = characters.first.map { String($0) } // Optional("a")

extension Optional {
  func map&lt;U&gt;(transform: (Wrapped) -&gt; U) -&gt; U? {
    if let value = self {
      return transform(value)
    }
    return nil
  }
}

let firstChar = characters.first.map { String($0) } // Optional("a")

extension Optional {
  func map&lt;U&gt;(transform: (Wrapped) -&gt; U) -&gt; U? {
    if let value = self {
      return transform(value)
    }
    return nil
  }
}

extension Array {
  func reduce(_ nextPartialResult: (Element, Element) -&gt; Element) -&gt; Element? {
    // å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œfirst å°†æ˜¯ nil
    guard let fst = first else { return nil }
    return dropFirst().reduce(fst, nextPartialResult)
  }
}

[1, 2, 3, 4].reduce(+) // Optional(10)

// å¯é€‰å€¼ä¸ºnilæ—¶ï¼Œå¯¹åº”çš„mapä¹Ÿä¼šè¿”å›nilï¼Œå°†guardæ”¹å†™ä¸ºå•return
extension Array {
  func reduce_alt(_ nextPartialResult: (Element, Element) -&gt; Element)
  -&gt; Element?
  {
    return first.map {
      dropFirst().reduce($0, nextPartialResult)
    }
  }
}
</code></pre></div></div>
<h4 id="10-å¯é€‰å€¼-flatmap">10. å¯é€‰å€¼ flatMap</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let stringNumbers = ["1", "2", "3", "foo"]
let x = stringNumbers.first.map { Int($0) } // Optional(Optional(1))

// flatMap å¯ä»¥æŠŠç»“æœå±•å¹³ä¸ºå•ä¸ªå¯é€‰å€¼
let y = stringNumbers.first.flatMap { Int($0) } // Optional(1)

if let a = stringNumbers.first, let b = Int(a) {
  print(b)
} // 1
// flatMapä¸if letéå¸¸ç›¸ä¼¼

let urlString = "https://www.objc.io/logo.png"
let view = URL(string: urlString)
.flatMap { try? Data(contentsOf: $0) }
.flatMap { UIImage(data: $0) }
.map { UIImageView(image: $0) }
if let view = view {
  PlaygroundPage.current.liveView = view
}

// å¯é€‰é“¾ä¹Ÿå’Œ flatMap å¾ˆç›¸ä¼¼ï¼ši?.advance(by: 1) å®é™…ä¸Šå’Œ i.flatMap { $0.advance(by: 1) } æ˜¯ç­‰ä»·çš„ã€‚

// å¤šä¸ª if let è¯­å¥ç­‰ä»·äº flatMap
extension Optional {
  func flatMap&lt;U&gt;(transform: (Wrapped) -&gt; U?) -&gt; U? {
    if let value = self, let transformed = transform(value) {
      return transformed
    }
    return nil
  }
}
</code></pre></div></div>
<h4 id="11-ä½¿ç”¨-flatmap-è¿‡æ»¤-nil">11. ä½¿ç”¨ flatMap è¿‡æ»¤ nil</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let numbers = ["1", "2", "3", "foo"]
var sum = 0
for case let i? in numbers.map({ Int($0) }) {
  sum += i
}
sum // 6

// ç”¨ ?? æ¥æŠŠ nil æ›¿æ¢æˆ 0
numbers.map { Int($0) }.reduce(0) { $0 + ($1 ?? 0) } // 6
// å°† nil è¿‡æ»¤å‡ºå»å¹¶å°†é nil å€¼è¿›è¡Œè§£åŒ…çš„ map
numbers.flatMap { Int($0) }.reduce(0, +) // 6
// æŠŠä¸€ä¸ªæ˜ å°„ä¸ºå¯é€‰å€¼çš„åºåˆ—è¿›è¡Œå±•å¹³

func flatten&lt;S: Sequence, T&gt;
(source: S) -&gt; [T] where S.Element == T? {
  let filtered = source.lazy.filter { $0 != nil }
  return filtered.map { $0! }
}
// å…¨å±€å‡½æ•°ï¼Œåè®®æ‰©å±•ä¸æ”¯æŒä¸¤ä¸ªå ä½ç¬¦è¯­å¥

extension Sequence {
  func flatMap&lt;U&gt;(transform: (Element) -&gt; U?) -&gt; [U] {
    return flatten(source: self.lazy.map(transform))
  }
}
//  lazy å°†æ•°ç»„çš„å®é™…åˆ›å»ºæ¨è¿Ÿåˆ°äº†ä½¿ç”¨å‰çš„æœ€åä¸€åˆ»,å¤„ç†å¾ˆå¤§çš„æ•°ç»„æ—¶ï¼Œé¿å…ä¸å¿…è¦çš„ä¸­é—´ç»“æœçš„ç¼“å†²åŒºå†…å­˜ç”³è¯·ã€‚
</code></pre></div></div>
<h4 id="12-å¯é€‰å€¼åˆ¤ç­‰">12. å¯é€‰å€¼åˆ¤ç­‰</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let regex = "^Hello$"
// ...
if regex.first == "^" {
  // åªåŒ¹é…å­—ç¬¦ä¸²å¼€å¤´
}

func ==&lt;T: Equatable&gt;(lhs: T?, rhs: T?) -&gt; Bool {
  switch (lhs, rhs) {
    case (nil, nil): return true
    case let (x?, y?): return x == y
    case (_?, nil), (nil, _?): return false
  }
}
// é‡è½½åªå¯¹å¯ä»¥åˆ¤ç­‰çš„å¯é€‰å€¼ç±»å‹æœ‰æ•ˆ

// æˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦å°† "^" å£°æ˜ä¸ºå¯é€‰å€¼
if regex.first == Optional("^") { // or: == .some("^")
  // åªåŒ¹é…å­—ç¬¦ä¸²å¼€å¤´
}
// å½“ä½ åœ¨ä½¿ç”¨ä¸€ä¸ªéå¯é€‰å€¼çš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦åŒ¹é…å¯é€‰å€¼ç±»å‹ï¼ŒSwift ä¼šå°†å®ƒâ€œå‡çº§â€ä¸ºä¸€ä¸ªå¯é€‰å€¼ç„¶åä½¿ç”¨

// ä¸¤è€…éƒ½å¯é€‰
func == &lt;T: Equatable&gt;(lhs: T?, rhs: T?) -&gt; Bool
// lhs éå¯é€‰
func == &lt;T: Equatable&gt;(lhs: T, rhs: T?) -&gt; Bool
// rhs éå¯é€‰
func == &lt;T: Equatable&gt;(lhs: T?, rhs: T) -&gt; Bool
// æˆ‘ä»¬åªéœ€è¦ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©æˆ‘ä»¬å°†å€¼åœ¨éœ€è¦æ—¶è½¬å˜ä¸ºå¯é€‰å€¼ã€‚

var dictWithNils: [String: Int?] = [
  "one": 1,
  "two": 2,
  "none": nil
]

dictWithNils["two"] = nil
dictWithNils // ["none": nil, "one": Optional(1)]
// å°†â€œtwoâ€é”®ç§»é™¤äº†

dictWithNils["two"] = Optional(nil)
dictWithNils["two"] = .some(nil)
dictWithNils["two"]? = nil
dictWithNils // ["none": nil, "one": Optional(1), "two": nil]

dictWithNils["three"]? = nil
dictWithNils.index(forKey: "three") // nil
</code></pre></div></div>
<h4 id="13-equatable-å’Œ-">13. Equatable å’Œ ==</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ä¸¤ä¸ªå¯é€‰å€¼æ•´æ•°çš„æ•°ç»„
let a: [Int?] = [1, 2, nil]
let b: [Int?] = [1, 2, nil]
// é”™è¯¯ï¼šbinary operator '==' cannot be applied to two [Int?] operands
a == b

// æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯éµå®ˆ Equatable åè®®
func ==&lt;Element : Equatable&gt;(lhs: [Element], rhs: [Element]) -&gt; Bool

// æœªæ¥ï¼Œå±Šæ—¶ä»£ç ä¼šè¿™æ ·ï¼š
extension Optional: Equatable where Wrapped: Equatable {
  // æ²¡æœ‰å¿…è¦å†™ä»»ä½•ä¸œè¥¿ï¼Œå› ä¸º == å·²ç»è¢«å®ç°äº†
}

// ç°åœ¨ä¸ºå¯é€‰å€¼çš„æ•°ç»„å®ç° ==
func ==&lt;T: Equatable&gt;(lhs: [T?], rhs: [T?]) -&gt; Bool {
  return lhs.elementsEqual(rhs) { $0 == $1 }
}
</code></pre></div></div>
<h4 id="14-å¯é€‰å€¼æ¯”è¾ƒ">14. å¯é€‰å€¼æ¯”è¾ƒ</h4>
<ul>
  <li>å’Œ == ç±»ä¼¼ï¼Œå¯¹äºå¯é€‰å€¼æ›¾ç»ä¹Ÿæœ‰åƒæ˜¯ &lt;ã€&gt;ã€&lt;= å’Œ &gt;= è¿™äº›æ“ä½œç¬¦ã€‚åœ¨ Swift 3.0 ä¸­ï¼Œè¿™äº›æ“ä½œç¬¦è¢«ä»å¯é€‰å€¼ä¸­ç§»é™¤äº†ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„ç»“æœã€‚<br />
æ¯”å¦‚è¯´ï¼Œnil &lt; .some(_) ä»¥å‰å°†è¿”å› trueã€‚åœ¨ä¸é«˜é˜¶å‡½æ•°æˆ–è€…å¯é€‰ç»‘å®šç»“åˆèµ·æ¥ä½¿ç”¨çš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šæ„å¤–ã€‚</li>
  <li>å¦‚æœä½ æƒ³è¦åœ¨å¯é€‰å€¼ä¹‹é—´è¿›è¡Œé™¤äº†ç›¸ç­‰ä¹‹å¤–çš„å…³ç³»æ¯”è¾ƒçš„è¯ï¼Œç°åœ¨ä½ éœ€è¦å…ˆå¯¹å®ƒä»¬è¿›è¡Œè§£åŒ…ï¼Œç„¶åæ˜ç¡®åœ°æŒ‡å‡º nil è¦å¦‚ä½•å¤„ç†ã€‚</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let temps = ["-459.67", "98.6", "0", "warm"]
let belowFreezing = temps.filter { Double($0) &lt; 0 }
// Double("warm") å°†ä¼šè¿”å› nilï¼Œè€Œ nil æ˜¯å°äº 0 çš„
</code></pre></div></div>
<h3 id="å››å¼ºåˆ¶è§£åŒ…çš„æ—¶æœº">å››ã€å¼ºåˆ¶è§£åŒ…çš„æ—¶æœº</h3>
<ul>
  <li>ä¿è¯å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¼ºåˆ¶è§£åŒ…ã€‚</li>
  <li>äº§ç”Ÿé”™è¯¯çš„å€¼å¼ºåˆ¶è§£åŒ…ç»ˆæ­¢ç¨‹åºä¼šæ–¹ä¾¿æŠ¥é”™ã€‚</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func flatten&lt;S: Sequence, T&gt;
(source: S) -&gt; [T] where S.Element == T? {
  let filtered = source.lazy.filter { $0 != nil }
  return filtered.map { $0! }
}
// filterè¿‡æ»¤äº†nilå…ƒç´ ï¼Œå¯ä»¥å¼ºåˆ¶è§£åŒ…

let ages = [
  "Tim": 53, "Angela": 54, "Craig": 44,
  "Jony": 47, "Chris": 37, "Michael": 34,
]
ages.keys
.filter { name in ages[name]! &lt; 50 }
.sorted()
// ["Chris", "Craig", "Jony", "Michael"]
// é”®éƒ½æ¥è‡ªå­—å…¸ï¼Œéå¸¸å®‰å…¨

ages.filter { (_, age) in age &lt; 50 }
.map { (name, _) in name }
.sorted()
// ["Chris", "Craig", "Jony", "Michael"]
// é¿å…ä¸å¿…è¦çš„ç”¨é”®è¿›è¡ŒæŸ¥æ‰¾
</code></pre></div></div>
<h4 id="1-æ”¹è¿›å¼ºåˆ¶è§£åŒ…çš„é”™è¯¯ä¿¡æ¯">1. æ”¹è¿›å¼ºåˆ¶è§£åŒ…çš„é”™è¯¯ä¿¡æ¯</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>infix operator !!
func !! &lt;T&gt;(wrapped: T?, failureText: @autoclosure () -&gt; String) -&gt; T {
  if let x = wrapped { return x }
  fatalError(failureText())
}

let s = "foo"
let i = Int(s) !! "Expecting integer, got \"\(s)\"
</code></pre></div></div>
<h4 id="2-åœ¨è°ƒè¯•ç‰ˆæœ¬ä¸­è¿›è¡Œæ–­è¨€">2. åœ¨è°ƒè¯•ç‰ˆæœ¬ä¸­è¿›è¡Œæ–­è¨€</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>infix operator !?
func !?&lt;T: ExpressibleByIntegerLiteral&gt;
(wrapped: T?, failureText: @autoclosure () -&gt; String) -&gt; T
{
  assert(wrapped != nil, failureText())
  return wrapped ?? 0
}

// åœ¨è°ƒè¯•æ—¶è§¦å‘æ–­è¨€ï¼Œä½†æ˜¯åœ¨å‘å¸ƒç‰ˆæœ¬ä¸­æ‰“å° 0ï¼š
let s = "20"
let i = Int(s) !? "Expecting integer, got \"\(s)\""

// å¯¹å…¶å­—é¢é‡è½¬æ¢åè®®è¿›è¡Œé‡è½½ï¼Œå¯ä»¥è¦†ç›–ä¸å°‘èƒ½å¤Ÿæœ‰é»˜è®¤å€¼çš„ç±»å‹
func !?&lt;T: ExpressibleByArrayLiteral&gt;
(wrapped: T?, failureText: @autoclosure () -&gt; String) -&gt; T
{
  assert(wrapped != nil, failureText())
  return wrapped ?? []
}

func !?&lt;T: ExpressibleByStringLiteral&gt;
  (wrapped: T?, failureText: @autoclosure () -&gt; String) -&gt; T
  {
  assert(wrapped != nil, failureText)
  return wrapped ?? ""
}

func !?&lt;T&gt;(wrapped: T?,
nilDefault: @autoclosure () -&gt; (value: T, text: String)) -&gt; T
{
  assert(wrapped != nil, nilDefault().text)
  return wrapped ?? nilDefault().value
}
// è°ƒè¯•ç‰ˆæœ¬ä¸­æ–­è¨€ï¼Œå‘å¸ƒç‰ˆæœ¬ä¸­è¿”å› 5
Int(s) !? (5, "Expected integer")

swift func !?(wrapped: ()?, failureText: @autoclosure () -&gt; String) {
  assert(wrapped != nil, failureText)
}
var output: String? = nil output?.write(â€œsomethingâ€) !? â€œWasnâ€™t expecting chained nil here

</code></pre></div></div>
<h3 id="äº”å¤šç¾å¤šéš¾çš„éšå¼è§£åŒ…å¯é€‰å€¼">äº”ã€å¤šç¾å¤šéš¾çš„éšå¼è§£åŒ…å¯é€‰å€¼</h3>
<p>éšå¼è§£åŒ…å¯é€‰å€¼ä½¿ç”¨æ—¶è‡ªåŠ¨å¼ºåˆ¶è§£åŒ…ï¼Œå®ƒç”¨åœ¨ç±»å‹çš„åé¢åŠ ä¸€ä¸ªæ„Ÿå¹å·æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚ UIView!ï¼Œå®ƒä»¬ä¾ç„¶æ˜¯å¯é€‰å€¼ã€‚ä½¿ç”¨éšå¼è§£åŒ…çš„åŸå› ï¼š</p>
<ul>
  <li>è¿˜éœ€è¦åˆ° Objective-C é‡Œå»è°ƒç”¨é‚£äº›æ²¡æœ‰æ£€æŸ¥è¿”å›æ˜¯å¦å­˜åœ¨çš„ä»£ç ã€‚</li>
  <li>ä¸€ä¸ªå€¼åªæ˜¯å¾ˆçŸ­æš‚åœ°ä¸º nilï¼Œåœ¨ä¸€æ®µæ—¶é—´åï¼Œå®ƒå°±å†ä¹Ÿä¸ä¼šæ˜¯ nilã€‚æ¯”å¦‚ï¼šViewControlleråˆå§‹åŒ–åï¼Œviewæ²¡è¢«åŠ è½½æ—¶ï¼Œoutletå¼•ç”¨è¿˜æ²¡åˆ›å»ºã€‚</li>
</ul>

<h4 id="1-éšå¼å¯é€‰å€¼è¡Œä¸º">1. éšå¼å¯é€‰å€¼è¡Œä¸º</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// éšå¼è§£åŒ…ä»å…·æœ‰å¯é€‰å€¼çš„ç‰¹æ€§
var s: String! = "Hello"
s?.isEmpty // Optional(false)
if let s = s { print(s) }
s = nil
s ?? "Goodbye" // Goodbye

// éšå¼å¯é€‰å€¼ä¼šå°½å¯èƒ½åœ°éšè—å®ƒä»¬çš„å¯é€‰å€¼ç‰¹æ€§ï¼Œåœ¨è¡Œä¸ºä¸Šè¿˜æ˜¯æœ‰ä¸ä¸€æ ·çš„åœ°æ–¹ã€‚
// ä½ ä¸èƒ½å°†ä¸€ä¸ªéšå¼è§£åŒ…çš„å€¼é€šè¿‡ inout çš„æ–¹æ³•ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼š
func increment(inout x: Int) {
x += 1
}
var i = 1 // æ™®é€šçš„ Int
increment(&amp;i) // å°† i å¢åŠ ä¸º 2
var j: Int! = 1 // éšå¼è§£åŒ…çš„ Int
increment(&amp;j)
// é”™è¯¯ï¼šCannot pass immutable value of type 'Int' as inout argument
</code></pre></div></div>
:ET