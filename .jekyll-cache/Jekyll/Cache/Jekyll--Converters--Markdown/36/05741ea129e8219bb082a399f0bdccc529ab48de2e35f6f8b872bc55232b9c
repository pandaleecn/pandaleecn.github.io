I"o“<ul>
  <li>å‡½æ•°å¯ä»¥è¢«èµ‹å€¼ç»™å˜é‡ï¼Œä¹Ÿèƒ½å¤Ÿä½œä¸ºå‡½æ•°çš„è¾“å…¥å’Œè¾“å‡º</li>
  <li>å‡½æ•°å¯ä»¥æ•è·å­˜åœ¨äºå®ƒä»¬ä½œç”¨èŒƒå›´ä¹‹å¤–çš„å˜é‡</li>
  <li>å‡½æ•°å¯ä»¥ä½¿ç”¨ { } æ¥å£°æ˜ä¸ºé—­åŒ…è¡¨è¾¾å¼</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// è¿™ä¸ªå‡½æ•°æ¥å— Int å€¼å¹¶å°†å…¶æ‰“å°
func printInt(i: Int) {
  print("you passed \(i)")
}
let funVar = printInt
funVar(2) // you passed 2
// ä¸èƒ½åœ¨ funVar è°ƒç”¨æ—¶åŒ…å«å‚æ•°æ ‡ç­¾ï¼Œè€Œåœ¨ printInt çš„è°ƒç”¨ (åƒæ˜¯ printInt(i: 2)) å´è¦æ±‚æœ‰å‚æ•°æ ‡ç­¾ã€‚
// Swift åªå…è®¸åœ¨å‡½æ•°å£°æ˜ä¸­åŒ…å«æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾ä¸æ˜¯å‡½æ•°ç±»å‹çš„ä¸€éƒ¨åˆ†

// å‡½æ•°ä½œä¸ºå‚æ•°
func useFunction(function: (Int) -&gt; () ) {
  function(3)
}
useFunction(function: printInt) // you passed 3
useFunction(function: funVar) // you passed 3

// å‡½æ•°ä½œä¸ºè¿”å›
func returnFunc() -&gt; (Int) -&gt; String {
  func innerFunc(i: Int) -&gt; String {
    return "you passed \(i)"
  }
  return innerFunc
}
let myFunc = returnFunc()
myFunc(3) // you passed 3

// æ•è·ä½œç”¨åŸŸä¹‹å¤–çš„å˜é‡
func counterFunc() -&gt; (Int) -&gt; String {
  var counter = 0
  func innerFunc(i: Int) -&gt; String {
    counter += i // counter is captured
    return "running total: \(counter)"
  }
  return innerFunc
}

let f = counterFunc()
f(3) // running total: 3
f(4) // running total: 7

let g = counterFunc()
g(2) // running total: 2
g(2) // running total: 4

f(2) // running total: 9

// func å…³é”®å­— å®šä¹‰å‡½æ•°
func doubler(i: Int) -&gt; Int {
  return i * 2
}
[1, 2, 3, 4].map(doubler) // [2, 4, 6, 8]

// é—­åŒ…è¡¨è¾¾å¼
let doublerAlt = { (i: Int) -&gt; Int in return i*2 }
[1, 2, 3, 4].map(doublerAlt) // [2, 4, 6, 8]
// ä½¿ç”¨é—­åŒ…è¡¨è¾¾å¼æ¥å®šä¹‰çš„å‡½æ•°å¯ä»¥è¢«æƒ³æˆå‡½æ•°çš„å­—é¢é‡ï¼Œå°±å’Œ 1 æ˜¯æ•´æ•°å­—é¢é‡ï¼Œ"hello" æ˜¯å­—ç¬¦ä¸²å­—é¢é‡é‚£æ ·ã€‚
// é—­åŒ…å’Œå‡½æ•°çš„åŒºåˆ«æ˜¯åŒ¿åçš„ï¼Œåªèƒ½åœ¨åˆ›å»ºæ—¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡åä½¿ç”¨ã€‚

[1, 2, 3].map { $0 * 2 } // [2, 4, 6]

[1, 2, 3].map( { (i: Int) -&gt; Int in return i * 2 } )
// ä¸å¿…å°†å‚æ•°è®¡ç®—å’Œå­˜å‚¨åœ¨å±€éƒ¨å˜é‡
[1, 2, 3].map( { i in return i * 2 } )
[1, 2, 3].map( { i in i * 2 } )
// å‚æ•°ç®€å†™ï¼Œ$0 ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ $1 ç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æ¨
// é—­åŒ…åªåŒ…å«ä¸€ä¸ªå•ä¸€è¡¨è¾¾å¼æ—¶ï¼Œç›´æ¥è¿”å›ï¼Œä¸éœ€è¦return
[1, 2, 3].map( { $0 * 2 } )
// å°¾éšé—­åŒ…è¯­æ³•ï¼šå‡½æ•°æœ€åä¸€ä¸ªå‚æ•°æ˜¯é—­åŒ…è¡¨è¾¾å¼æ—¶ï¼Œå¯ä»¥åˆ°æ‹¬å·å¤–éƒ¨
// æ›´æ¥è¿‘æ™®é€šå‡½æ•°çš„å®šä¹‰ï¼Œæˆ–åƒ if (expr) { } è¿™æ ·çš„æ‰§è¡Œå—çš„è¡¨è¾¾å½¢å¼
[1, 2, 3].map() { $0 * 2 }
[1, 2, 3].map { $0 * 2 }

(0..&lt;3).map { _ in arc4random() } // [4207687330, 4213709746, 366609532]

// isEven è¢«æ¨æ–­ä¸º Int -&gt; Bool
let isEven = { $0 % 2 == 0 }

// ä¸ºè¿”å›å€¼æŒ‡å®šç±»å‹
let isEvenAlt = { (i: Int8) -&gt; Bool in i % 2 == 0 }

// åœ¨é—­åŒ…å¤–éƒ¨ä¸Šä¸‹æ–‡æä¾›
let isEvenAlt2: (Int8) -&gt; Bool = { $0 % 2 == 0 }
let isEvenAlt3 = { $0 % 2 == 0 } as (Int8) -&gt; Bool

// å¯¹æ‰€æœ‰è¯ä¹¦ç±»å‹æ·»åŠ ä½¿ç”¨çš„ isEven æ³›å‹ç‰ˆæœ¬çš„è®¡ç®—å±æ€§
extension BinaryInteger {
  var isEven: Bool { return self % 2 == 0 }
}
// ä¸ºæ‰€æœ‰çš„ BinaryInteger å®šä¹‰ä¸€ä¸ªé¡¶å±‚å‡½æ•°ï¼š
func isEven&lt;T: BinaryInteger&gt;(_ i: T) -&gt; Bool {
  return i % 2 == 0
}

// å°†é¡¶å±‚å‡½æ•°èµ‹å€¼ç»™å˜é‡
let int8isEven: (Int8) -&gt; Bool = isEven
</code></pre></div></div>
<h3 id="ä¸€å‡½æ•°çš„çµæ´»æ€§">ä¸€ã€å‡½æ•°çš„çµæ´»æ€§</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Swiftæ’åºå¾ˆç®€å•
let myArray = [3, 1, 2]
myArray.sorted() // [1, 2, 3]

myArray.sorted(by: &gt;) // [3, 2, 1]

var numberStrings = [(2, "two"), (1, "one"), (3, "three")]
numberStrings.sort(by: &lt;)
numberStrings // [(1, "one"), (2, "two"), (3, "three")]

let animals = ["elephant", "zebra", "dog"]
animals.sorted { lhs, rhs in
  let l = lhs.reversed()
  let r = rhs.reversed()
  return l.lexicographicallyPrecedes(r)
}
// ["zebra", "dog", "elephant"]

// Objective-C
// @objcMembersæ ‡è®°ï¼Œå®ƒçš„æ‰€æœ‰æˆå‘˜éƒ½å°†åœ¨ Objective-C ä¸­å¯è§
@objcMembers
final class Person: NSObject {
  let first: String
  let last: String
  let yearOfBirth: Int
  init(first: String, last: String, yearOfBirth: Int) {
    self.first = first
    self.last = last
    self.yearOfBirth = yearOfBirth
  }
}

let lastDescriptor = NSSortDescriptor(key: #keyPath(Person.last),
ascending: true,
selector: #selector(NSString.localizedStandardCompare(_:)))
let firstDescriptor = NSSortDescriptor(key: #keyPath(Person.first),
ascending: true,
selector: #selector(NSString.localizedStandardCompare(_:)))
let yearDescriptor = NSSortDescriptor(key: #keyPath(Person.yearOfBirth),
ascending: true)

// æè¿°ç¬¦ç›¸åŒæ—¶ï¼Œä¾æ¬¡æ£€æŸ¥
let descriptors = [lastDescriptor, firstDescriptor, yearDescriptor]
(people as NSArray).sortedArray(using: descriptors)
/*
[Ava Barnes (1998), Ava Barnes (2000), Robert Barnes (1985),
David Gray (1991), Joanne Miller (1994), Emily Young (2002)]
*/
// è¿è¡Œæ—¶çš„ä½¿ç”¨ï¼š
// 1. key æ—¶ Objective-C çš„é”®è·¯å¾„ï¼Œæ—¶ä¸€ä¸ªåŒ…å«å±æ€§åå­—çš„é“¾è¡¨ã€‚
// 2. KVC é”®å€¼ç¼–ç¨‹ï¼Œselector åœ¨è¿è¡Œæ—¶è¢«ç”¨æ¥æŸ¥æ‰¾æ¯”è¾ƒå‡½æ•°ã€‚

// Swiftå®ç°
var strings = ["Hello", "hallo", "Hallo", "hello"]
strings.sort { $0.localizedStandardCompare($1) == .orderedAscending}
strings // ["hallo", "Hallo", "hello", "Hello"]

people.sorted { $0.yearOfBirth &lt; $1.yearOfBirth }
/*
[Robert Barnes (1985), David Gray (1991), Joanne Miller (1994),
Ava Barnes (1998), Ava Barnes (2000), Emily Young (2002)]
*/

// å¯é€‰å€¼çš„å®ç°éå¸¸ä¸‘é™‹ï¼š
var files = ["one", "file.h", "file.c", "test.h"]
files.sort { l, r in r.fileExtension.flatMap {
  l.fileExtension?.localizedStandardCompare($0)
} == .orderedAscending }
files // ["one", "file.c", "file.h", "test.h"]

// ä¼˜åŒ– lexicographicallyPrecedesï¼Œæ ‡å‡†åº“ï¼Œç”µè¯ç°¿æ–¹å¼çš„æ¯”è¾ƒ
people.sorted { p0, p1 in
  let left = [p0.last, p0.first]
  let right = [p1.last, p1.first]
  return left.lexicographicallyPrecedes(right) {
    $0.localizedStandardCompare($1) == .orderedAscending
  }
}
/*
[Ava Barnes (2000), Ava Barnes (1998), Robert Barnes (1985),
David Gray (1991), Joanne Miller (1994), Emily Young (2002)]
*/
</code></pre></div></div>
<h4 id="1-å‡½æ•°ä½œä¸ºæ•°æ®">1. å‡½æ•°ä½œä¸ºæ•°æ®</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/// ä¸€ä¸ªæ’åºæ–­è¨€ï¼Œå½“ä¸”ä»…å½“ç¬¬ä¸€ä¸ªå€¼åº”å½“æ’åºåœ¨ç¬¬äºŒä¸ªå€¼ä¹‹å‰æ—¶ï¼Œè¿”å› `true`
typealias SortDescriptor&lt;Value&gt; = (Value, Value) -&gt; Bool

let sortByYear: SortDescriptor&lt;Person&gt; = { $0.yearOfBirth &lt; $1.yearOfBirth }
let sortByLastName: SortDescriptor&lt;Person&gt; = {
  $0.last.localizedStandardCompare($1.last) == .orderedAscending
}

/// é€šè¿‡ä¸€ä¸ªæ’åºæ–­è¨€ï¼Œä»¥åŠä¸€ä¸ªèƒ½ç»™å®šæŸä¸ªå€¼ï¼Œå°±èƒ½å¯¹åº”äº§ç”Ÿåº”è¯¥ç”¨äº
/// æ’åºæ–­è¨€çš„å€¼çš„ `key` å‡½æ•°ï¼Œæ¥æ„å»ºä¸€ä¸ª `SortDescriptor` å‡½æ•°ã€‚
func sortDescriptor&lt;Value, Key&gt;(
key: @escaping (Value) -&gt; Key,
by areInIncreasingOrder: @escaping (Key, Key) -&gt; Bool)
-&gt; SortDescriptor&lt;Value&gt;
{
  return { areInIncreasingOrder(key($0), key($1)) }
}

let sortByYearAlt: SortDescriptor&lt;Person&gt; =
sortDescriptor(key: { $0.yearOfBirth }, by: &lt;)
people.sorted(by: sortByYearAlt)
/*
[Robert Barnes (1985), David Gray (1991), Joanne Miller (1994),
Ava Barnes (1998), Ava Barnes (2000), Emily Young (2002)]
*/

// ä¸ºæ‰€æœ‰çš„ Comparable ç±»å‹å®šä¹‰ä¸€ä¸ªé‡è½½ç‰ˆæœ¬çš„å‡½æ•°ï¼š
func sortDescriptor&lt;Value, Key&gt;(key: @escaping (Value) -&gt; Key)
-&gt; SortDescriptor&lt;Value&gt; where Key: Comparable
{
return { key($0) &lt; key($1) }
}
let sortByYearAlt2: SortDescriptor&lt;Person&gt; =
sortDescriptor(key: { $0.yearOfBirth })

// å®ç° localizedStandardCompare ï¼šè¿”å›åŒ…å« (å‡åºï¼Œé™åºï¼Œç›¸ç­‰) ä¸‰ç§å€¼çš„ ComparisonResult çš„ç»“æœ
func sortDescriptor&lt;Value, Key&gt;(
key: @escaping (Value) -&gt; Key,
ascending: Bool = true,
by comparator: @escaping (Key) -&gt; (Key) -&gt; ComparisonResult)
-&gt; SortDescriptor&lt;Value&gt;
{
  return { lhs, rhs in
    let order: ComparisonResult = ascending
    ? .orderedAscending
    : .orderedDescending
    return comparator(key(lhs))(key(rhs)) == order
  }
}

let sortByFirstName: SortDescriptor&lt;Person&gt; =
sortDescriptor(key: { $0.first }, by: String.localizedStandardCompare)
people.sorted(by: sortByFirstName)
/*
[Ava Barnes (2000), Ava Barnes (1998), David Gray (1991),
Emily Young (2002), Joanne Miller (1994), Robert Barnes (1985)]
*/
// SortDescriptor ç°åœ¨ä¸ NSSortDescriptor æ‹¥æœ‰äº†åŒæ ·åœ°è¡¨è¾¾èƒ½åŠ›ï¼Œä¸è¿‡å®ƒæ˜¯ç±»å‹å®‰å…¨çš„ï¼Œè€Œä¸”ä¸ä¾èµ–äºè¿è¡Œæ—¶ç¼–ç¨‹ã€‚

// å®ç° NSArray.sortedArray(using:) æ–¹æ³•æ¥ç”¨å¤šä¸ªæ¯”è¾ƒè¿ç®—ç¬¦å¯¹æ•°ç»„è¿›è¡Œæ’åº
func combine&lt;Value&gt;
(sortDescriptors: [SortDescriptor&lt;Value&gt;]) -&gt; SortDescriptor&lt;Value&gt; {
  return { lhs, rhs in
    for areInIncreasingOrder in sortDescriptors {
      if areInIncreasingOrder(lhs, rhs) { return true }
      if areInIncreasingOrder(rhs, lhs) { return false }
    }
    return false
  }
}

let combined: SortDescriptor&lt;Person&gt; = combine(
  sortDescriptors: [sortByLastName, sortByFirstName, sortByYear]
)
people.sorted(by: combined)
/*
[Ava Barnes (1998), Ava Barnes (2000), Robert Barnes (1985),
David Gray (1991), Joanne Miller (1994), Emily Young (2002)]
*/
// è¿™ç§æ–¹å¼çš„å®è´¨æ˜¯å°†å‡½æ•°ç”¨ä½œæ•°æ®ï¼Œå°†è¿™äº›å‡½æ•°å­˜å‚¨åœ¨æ•°ç»„é‡Œï¼Œå¹¶åœ¨è¿è¡Œæ—¶æ„å»ºè¿™ä¸ªæ•°ç»„ã€‚
// Swift è¿™æ ·çš„ç¼–è¯‘æ—¶å°±ç¡®å®šäº†é™æ€ç±»å‹çš„è¯­è¨€ä»ç„¶èƒ½å®ç°åƒæ˜¯ Objective-C æˆ–è€… Ruby çš„éƒ¨åˆ†åŠ¨æ€è¡Œä¸ºçš„ä¸€ç§æ–¹å¼ã€‚

// è‡ªå®šä¹‰è¿ç®—ç¬¦ï¼Œåˆå¹¶ä¸¤ä¸ªæ’åºå‡½æ•°
infix operator &lt;||&gt; : LogicalDisjunctionPrecedence
func &lt;||&gt;&lt;A&gt;(lhs: @escaping (A,A) -&gt; Bool, rhs: @escaping (A,A) -&gt; Bool)
-&gt; (A,A) -&gt; Bool
{
  return { x, y in
    if lhs(x, y) { return true }
    if lhs(y, x) { return false }
    // å¦åˆ™ï¼Œå®ƒä»¬å°±æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ£€æŸ¥ç¬¬äºŒä¸ªæ¡ä»¶
    if rhs(x, y) { return true }
    return false
  }
}

let combinedAlt = sortByLastName &lt;||&gt; sortByFirstName &lt;||&gt; sortByYear
people.sorted(by: combinedAlt)
/*
[Ava Barnes (1998), Ava Barnes (2000), Robert Barnes (1985),
David Gray (1991), Joanne Miller (1994), Emily Young (2002)]
*/

// å¤„ç†å¯é€‰å€¼ï¼Œéƒ½æ˜¯ nil ç›¸ç­‰ï¼Œå¦åˆ™å·¦ä¾§ nil é™åºï¼Œå³ä¾§ nil å‡åº
func lift&lt;A&gt;(_ compare: @escaping (A) -&gt; (A) -&gt; ComparisonResult) -&gt; (A?) -&gt; (A?)
-&gt; ComparisonResult
{
  return { lhs in { rhs in
    switch (lhs, rhs) {
    case (nil, nil): return .orderedSame
    case (nil, _): return .orderedAscending
    case (_, nil): return .orderedDescending
    case let (l?, r?): return compare(l)(r)
    }
  } }
}

let compare = lift(String.localizedStandardCompare)
let result = files.sorted(by: sortDescriptor(key: { $0.fileExtension },
by: compare))
result // ["one", "file.c", "file.h", "test.h"]

// Swift å†…çœæ’åºæ˜¯å¿«é€Ÿæ’åºå’Œå †æ’åºçš„æ··åˆï¼Œé›†åˆå°æ—¶ä¼šé‡‡ç”¨æ’å…¥æ’åºï¼Œä¸ç¨³å®šã€‚
// ä½¿ç”¨è¿™ç§æ–¹æ³•å¯ä»¥å°†æ’åºæ–¹æ³•å’Œæ¯”è¾ƒæ–¹æ³•åˆ†ç¦»ï¼Œå°†ä¸¤ä¸ªå€¼äº¤æ¢ï¼Œå®ç°ç¨³å®šæ’åºã€‚
// ç¨³å®šï¼šä¸¤ä¸ªç›¸ç­‰çš„å€¼åœ¨æ’åºå‰åçš„é¡ºåºæ˜¯å¦ä¸€è‡´ã€‚
people.stablySorted(by: combine(
  sortDescriptors: [sortByLastName, sortByFirstName, sortByYear]
))
</code></pre></div></div>
<h3 id="äºŒå±€éƒ¨å‡½æ•°å’Œå˜é‡æ•æ‰">äºŒã€å±€éƒ¨å‡½æ•°å’Œå˜é‡æ•æ‰</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// å½’å¹¶æ’åºï¼šç¨³å®šï¼Œå°†å¾…æ’åºæ•°ç»„åˆ†ä¸ºå•ä¸ªå…ƒç´ çš„å­åˆ—è¡¨åï¼Œè¿›è¡Œä¸æ–­çš„åˆå¹¶ã€‚
extension Array where Element: Comparable {

  mutating func mergeSortInPlace() {
    // å®šä¹‰æ‰€æœ‰ merge æ“ä½œæ‰€ä½¿ç”¨çš„ä¸´æ—¶å­˜å‚¨
    var tmp: [Element] = []
    // å¹¶ä¸”ç¡®ä¿å®ƒçš„å¤§å°è¶³å¤Ÿ
    tmp.reserveCapacity(count)
    func merge(lo: Int, mi: Int, hi: Int) {
      // æ¸…ç©ºå­˜å‚¨ï¼Œä½†æ˜¯ä¿ç•™å®¹é‡ä¸å˜
      tmp.removeAll(keepingCapacity: true)
      // å’Œä¸Šé¢çš„ä»£ç ä¸€æ ·
      var i = lo, j = mi
      while i != mi &amp;&amp; j != hi {
        if self[j] &lt; self[i] {
          tmp.append(self[j])
          j += 1
        } else {
          tmp.append(self[i])
          i += 1
        }
      }
      tmp.append(contentsOf: self[i..&lt;mi])
      tmp.append(contentsOf: self[j..&lt;hi])
      replaceSubrange(lo..&lt;hi, with: tmp)
    }
    let n = count
    var size = 1
    while size &lt; n {
      for lo in stride(from: 0, to: n-size, by: size*2) {
        merge(lo: lo, mi: (lo+size), hi: Swift.min(lo+size*2,n))
      }
      size *= 2
    }
  }
}
</code></pre></div></div>
<h3 id="ä¸‰å‡½æ•°ä½œä¸ºä»£ç†">ä¸‰ã€å‡½æ•°ä½œä¸ºä»£ç†</h3>
<p>æ³¨å†Œå•ä¸ªæ–¹æ³•çš„ä»£ç†åè®®å¹¶æ³¨å†Œï¼Œå­˜å‚¨å›è°ƒå‡½æ•°çš„å±æ€§ï¼Œè¿›è¡Œå›è°ƒã€‚</p>
<h4 id="1-foundation-æ¡†æ¶çš„ä»£ç†">1. Foundation æ¡†æ¶çš„ä»£ç†</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>protocol AlertViewDelegate: AnyObject {
  func buttonTapped(atIndex: Int)
}

class AlertView {
  var buttons: [String]
  // å°†ä»£ç†å£°æ˜ä¸º weakï¼Œä¸éœ€è¦æ‹…å¿ƒå¾ªç¯å¼•ç”¨
  weak var delegate: AlertViewDelegate?
  init(buttons: [String] = ["OK", "Cancel"]) {
    self.buttons = buttons
  }
  func fire() {
    delegate?.buttonTapped(atIndex: 1)
  }
}

class ViewController: AlertViewDelegate {
  let alert: AlertView
  init() {
    alert = AlertView(buttons: ["OK", "Cancel"])
    alert.delegate = self
  }
  func buttonTapped(atIndex index: Int) {
    print("Button tapped: \(index)")
  }
}
</code></pre></div></div>
<h4 id="2-ç»“æ„ä½“ä»£ç†">2. ç»“æ„ä½“ä»£ç†</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>protocol AlertViewDelegate {
  mutating func buttonTapped(atIndex: Int)
}

class AlertView {
  var buttons: [String]
  // å½“éœ€è¦å¯¹ AlertView çš„ delegate å±æ€§è¿›è¡Œæ›´æ”¹æ—¶ï¼Œä¸èƒ½ä½¿ç”¨å¼±å¼•ç”¨
  var delegate: AlertViewDelegate?
  init(buttons: [String] = ["OK", "Cancel"]) {
    self.buttons = buttons
  }
  func fire() {
    delegate?.buttonTapped(atIndex: 1)
  }
}

// ä¸èƒ½è®²å¯¹è±¡èµ‹å€¼ç»™ delegate å±æ€§ï¼Œå¦åˆ™ä¼šå¼ºå¼•ç”¨ï¼Œå¯¼è‡´å¾ªç¯å¼•ç”¨
// åˆ›å»ºè®°å½•ç´ æœ‰æŒ‰é’®äº‹ä»¶çš„ç»“æ„ä½“
struct TapLogger: AlertViewDelegate {
  var taps: [Int] = []
  mutating func buttonTapped(atIndex index: Int) {
    taps.append(index)
  }
}

let alert = AlertView()
var logger = TapLogger()
alert.delegate = logger
alert.fire()
logger.taps // []
// æ•°ç»„ä¸ºç©ºï¼ŒåŸå› æ˜¯ç»“æ„ä½“ä¼ é€’æ—¶æµ…å¤åˆ¶ï¼Œä¼ é€’æ—¶å¯¹å€¼è¿›è¡Œäº†å¤åˆ¶

// è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å®¹æ˜“äº§ç”Ÿå¾ªç¯å¼•ç”¨
// åœ¨ä»£ç†å’Œåè®®çš„æ¨¡å¼ä¸­ï¼Œä¸é€‚åˆä½¿ç”¨ç»“æ„ä½“
if let theLogger = alert.delegate as? TapLogger {
  print(theLogger.taps)
}
// [1]
</code></pre></div></div>
<h4 id="3-ä½¿ç”¨å‡½æ•°è€Œéä»£ç†">3. ä½¿ç”¨å‡½æ•°ï¼Œè€Œéä»£ç†</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class AlertView {
  var buttons: [String]
  var buttonTapped: ((_ buttonIndex: Int) -&gt; ())?
  init(buttons: [String] = ["OK", "Cancel"]) {
    self.buttons = buttons
  }
  func fire() {
    buttonTapped?(1)
  }
}

struct TapLogger {
  var taps: [Int] = []
  mutating func logTap(index: Int) {
    taps.append(index)
  }
}
let alert = AlertView()
var logger = TapLogger()

// ç¼–è¯‘å™¨ä¼šä¸å…è®¸éƒ¨åˆ†åº”ç”¨â€˜å¯å˜â€™æ–¹æ³•
alert.buttonTapped = logger.logTap // é”™è¯¯

// è§£è€¦ï¼Œå›è°ƒå±æ€§åå’Œå®ç°å‡½æ•°åç›¸ç‹¬ç«‹
alert.buttonTapped = { logger.logTap(index: $0) }
alert.buttonTapped = { print("Button \($0) was tapped") }

class ViewController {
  let alert: AlertView
  init() {
    alert = AlertView(buttons: ["OK", "Cancel"])
    // ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨
    // alert.buttonTapped = self.buttonTapped(atIndex:)
    // é¿å…å¾ªç¯å¼•ç”¨ï¼Œå½“ alert view ç”Ÿå‘½å‘¨æœŸè¶…è¿‡ view controller æ—¶ï¼Œå½“å‡½æ•°è¢«è°ƒç”¨ï¼Œé—­åŒ…é‡Œçš„self å°†ä¸º nil
    alert.buttonTapped = { [weak self] index in
      self?.buttonTapped(atIndex: index)
    }
  }
  func buttonTapped(atIndex index: Int) {
    print("Button tapped: \(index)")
  }
}
</code></pre></div></div>
<ul>
  <li>ä½¿ç”¨å‡½æ•°ä»£æ›¿ä»£ç†æ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨ç»“æ„ä½“å’ŒåŒ¿åå‡½æ•°ï¼Œä½†æ˜¯è¦é¿å…å¾ªç¯å¼•ç”¨</li>
  <li>å½“å¤„ç†ä¸€ç»„å¯†åˆ‡è”ç³»çš„å¤šä¸ªå›è°ƒå‡½æ•°æ—¶ï¼Œå¿…é¡»å°†å…¶ç»„ç»‡åœ¨åŒä¸€ä¸ªåè®®é‡Œï¼ŒåŒæ—¶å®ç°æ‰€æœ‰æ–¹æ³•ã€‚</li>
  <li>æ³¨é”€ä»£ç†å’Œå‡½æ•°å›è°ƒæ—¶ï¼Œå¯ä»¥è®¾ä¸º nilï¼Œå­˜å‚¨åœ¨æ•°ç»„ä¸­çš„å›è°ƒå‡½æ•°éœ€è¦äºŒå¤–æ·»åŠ é€»è¾‘å»é™¤ã€‚</li>
</ul>

<h3 id="å››inout-å‚æ•°å’Œå¯å˜æ–¹æ³•">å››ã€inout å‚æ•°å’Œå¯å˜æ–¹æ³•</h3>
<p>inout å‚æ•°å°†ä¸€ä¸ªå€¼ä¼ é€’ç»™å‡½æ•°ï¼Œå‡½æ•°å¯ä»¥æ”¹å˜è¿™ä¸ªå€¼ï¼Œç„¶åå°†åŸæ¥çš„å€¼æ›¿æ¢æ‰ï¼Œå¹¶ä»å‡½æ•°ä¸­ä¼ å‡ºã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// lvalue å’Œ rvalue ï¼š
// lvalue æè¿°çš„æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå®ƒæ˜¯â€œå·¦å€¼ (left value)â€ çš„ç¼©å†™
// lvalues æ˜¯å¯ä»¥å­˜åœ¨äºèµ‹å€¼è¯­å¥å·¦ä¾§çš„è¡¨è¾¾å¼
// array[0] æ˜¯ä¸€ä¸ª lvalueï¼Œå®ƒä»£è¡¨çš„æ˜¯æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€åœ¨çš„å†…å­˜ä½ç½®
// rvalue æè¿°çš„æ˜¯ä¸€ä¸ªå€¼ã€‚2 + 2 æ˜¯ä¸€ä¸ª rvalueï¼Œå®ƒæè¿°çš„æ˜¯ 4 è¿™ä¸ªå€¼ï¼Œä¸èƒ½æ”¾åœ¨èµ‹å€¼è¯­å¥çš„å·¦ä¾§ã€‚

func increment(value: inout Int) {
  value += 1
}
var i = 0
// ä¼ é€’æ·»åŠ  &amp; å‰ç¼€çš„ lvalue
increment(value: &amp;i)

// let å®šä¹‰çš„å˜é‡ï¼Œä¸èƒ½ç”¨ä½œ lvalueï¼Œinout æ²¡æœ‰æ„ä¹‰ã€‚
let y: Int = 0
increment(value: &amp;y) // é”™è¯¯

// è¿˜æœ‰æ•°ç»„å’Œå…¶ä»–ç±»å‹çš„ lvalue
var array = [0, 1, 2]
increment(value: &amp;array[0])
array // [1, 1, 2]

// æ‰€æœ‰ä¸‹æ ‡ï¼ŒåŒ…å«è‡ªå®šä¹‰çš„ï¼Œåªè¦åŒæ—¶æ‹¥æœ‰ get å’Œ setï¼Œéƒ½é€‚ç”¨
struct Point {
  var x: Int
  var y: Int
}
var point = Point(x: 0, y: 0)
increment(value: &amp;point.x)
point // Point(x: 1, y: 0)

// åªè¯»åªæœ‰ get å¯ç”¨ï¼Œä¸èƒ½ç”¨äº inout å‚æ•°
extension Point {
  var squaredDistance: Int {
    return x*x + y*y
  }
}
increment(value: &amp;point.squaredDistance) // é”™è¯¯

// è¿ç®—ç¬¦å¯ä»¥æ¥å— inout å€¼ï¼Œä¸ºäº†ç®€åŒ–ï¼Œè°ƒç”¨æ—¶ä¸éœ€è¦åŠ  &amp; ç¬¦å·ï¼Œç›´æ¥é€‚ç”¨ lvalue
postfix func ++(x: inout Int) {
  x += 1
}
point.x++
point // Point(x: 2, y: 0)

// å¯å˜è¿ç®—ç¬¦ä¸å¯é€‰é“¾ä¸€èµ·ä½¿ç”¨
var dictionary = ["one": 1]
dictionary["one"]?++
dictionary["one"] // Optional(2)
// å½“å­—å…¸æŸ¥åˆ°è¿”å› nil çš„æ—¶å€™ï¼Œ++ æ“ä½œç¬¦ä¸ä¼šè¢«æ‰§è¡Œ
</code></pre></div></div>
<h4 id="1-åµŒå¥—å‡½æ•°å’Œ-inout">1. åµŒå¥—å‡½æ•°å’Œ inout</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// åµŒå¥—å‡½æ•°å¯ä»¥å®‰å…¨åœ°ä¿®æ”¹ inout å‚æ•°ï¼Œä½†ä¸èƒ½é€ƒé€¸
func incrementTenTimes(value: inout Int) {
  func inc() {
    value += 1
  }
  for _ in 0..&lt;10 {
    inc()
  }
}
var x = 0
incrementTenTimes(value: &amp;x)
x // 10

func escapeIncrement(value: inout Int) -&gt; () -&gt; () {
  func inc() {
    value += 1
  }
  // error: åµŒå¥—å‡½æ•°ä¸èƒ½æ•è· inout å‚æ•°
  return inc
}
// inout å€¼å®åœ¨è¿”å›å‰å¤åˆ¶ï¼Œé€ƒé€¸åçš„æ“ä½œæ— æ³•ç»§ç»­ä¿®æ”¹å¤åˆ¶å®Œæˆçš„å€¼ï¼Œå­˜åœ¨å®‰å…¨é—®é¢˜ã€‚
</code></pre></div></div>
<h4 id="2--ä¸æ„å‘³-inout-çš„æƒ…å†µ">2. &amp; ä¸æ„å‘³ inout çš„æƒ…å†µ</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ç›´æ¥ä¼ é€’å¼•ç”¨çš„æŒ‡é’ˆï¼Œå°†å˜é‡è½¬åŒ–ä¸ºä¸€ä¸ªä¸å®‰å…¨çš„æŒ‡é’ˆ
func incref(pointer: UnsafeMutablePointer&lt;Int&gt;) -&gt; () -&gt; Int {
  // å°†æŒ‡é’ˆçš„çš„å¤åˆ¶å­˜å‚¨åœ¨é—­åŒ…ä¸­
  return {
    pointer.pointee += 1
    return pointer.pointee
  }
}

let fun: () -&gt; Int
do {
  var array = [0]
  fun = incref(pointer: &amp;array)
}
fun()
// æ¯æ¬¡æ‰“å°ä¸åŒçš„å€¼ï¼Œæœ‰æ—¶å€™æ˜¯ 0ï¼Œæœ‰æ—¶å€™æ˜¯ 1ï¼Œæœ‰æ—¶å€™æ˜¯ 140362397107840ã€‚
// å‚æ•°æ·»åŠ  &amp; æ—¶ï¼Œè°ƒç”¨äº† inout è¯­ä¹‰ï¼Œä¹Ÿå¯èƒ½æ˜¯å°†å˜é‡è½¬åŒ–ä¸ºä¸å®‰å…¨çš„æŒ‡é’ˆã€‚
</code></pre></div></div>
<h3 id="äº”è®¡ç®—å±æ€§">äº”ã€è®¡ç®—å±æ€§</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import CoreLocation

struct GPSTrack {
  private(set) var record: [(CLLocation, Date)] = []
}

extension GPSTrack {
  /// è¿”å› GPS è¿½è¸ªçš„æ‰€æœ‰æ—¶é—´æˆ³
  /// - å¤æ‚åº¦ï¼šO(n)ï¼Œn æ˜¯è®°å½•ç‚¹çš„æ•°é‡ã€‚
  var timestamps: [Date] {
    return record.map { $0.1 }
  }
}

// timestamps å±æ€§åªè¯»ï¼Œæ²¡æœ‰ setterï¼Œç»“æœä¸ä¼šç¼“å­˜ï¼Œæ¯æ¬¡è®¿é—®éƒ½è¦è®¡ç®—ã€‚
// Swift API æŒ‡å—å»ºè®®å°†å¤æ‚åº¦ä¸æ˜¯ O(1) çš„è®¡ç®—å±æ€§åœ¨æ–‡æ¡£ä¸­å†™æ˜ï¼Œé˜²æ­¢è°ƒç”¨è€…è®¤ä¸ºæ˜¯å¸¸æ•°äº‹æ—¶é—´ã€‚
</code></pre></div></div>
<h4 id="1-è§‚å¯Ÿå˜æ›´">1. è§‚å¯Ÿå˜æ›´</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class SettingsController: UIViewController {
  @IBOutlet weak var label: UILabel? {
    // åœ¨ IBOutlet è¿æ¥æ—¶ï¼Œæ‰§è¡Œé¢å¤–çš„é…ç½®æ“ä½œ
    // ä¸“é—¨ä¸ºç±»å‹çš„è®¾è®¡è€…ä½¿ç”¨ï¼Œè€Œéç±»å‹ç”¨æˆ·ï¼Œæ— æ³•åœ¨æ‰©å±•ä¸­è¿½åŠ ã€‚
    didSet {
      label?.textColor = .black
    }
  }
}

// åœ¨å­ç±»ä¸­é‡å†™å±æ€§ï¼Œæ·»åŠ è§‚å¯Ÿè€…
class Robot {
  enum State {
    case stopped, movingForward, turningRight, turningLeft
  }
  var state = State.stopped
}
class ObservableRobot: Robot {
  override var state: State {
    willSet {
      print("çŠ¶æ€ä» \(state) è¿ç§»åˆ° \(newValue)")
    }
  }
}
var robot = ObservableRobot()
robot.state = .movingForward // çŠ¶æ€ä» stopped è¿ç§»åˆ° movingForward
// Swift çš„å±æ€§è§‚å¯Ÿæ˜¯çº¯ç²¹çš„ç¼–è¯‘æ—¶ç‰¹æ€§ï¼Œæ— æ³•å®ç° Objective-C KVO åŠ¨æ€ä¸ºç±»çš„ setter æ·»åŠ è§‚å¯Ÿè€…çš„è¿è¡Œæ—¶ç‰¹æ€§ã€‚
</code></pre></div></div>
<h4 id="2-å»¶è¿Ÿå­˜å‚¨å±æ€§">2. å»¶è¿Ÿå­˜å‚¨å±æ€§</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// lazy å…³é”®å­—ï¼Œå»¶è¿Ÿå±æ€§ï¼ˆlazy propertyï¼‰
// è‡ªåŠ¨å£°æ˜ä¸º varï¼Œåˆå§‹åŒ–æ–¹æ³•å®Œæˆæ—¶ä¸ä¼šè¢«è®¾ç½®ï¼Œlet å¿…é¡»åœ¨å®Œæˆä¹‹å‰æ‹¥æœ‰å€¼ã€‚
class GPSTrackViewController: UIViewController {
  var track: GPSTrack = GPSTrack()
  // ä½¿ç”¨é—­åŒ…è¡¨è¾¾å¼è¿”å›å­˜å‚¨çš„å€¼
  lazy var preview: UIImage = {
    for point in track.record {
      // è¿›è¡Œæ˜‚è´µçš„è®¡ç®—
    }
    return UIImage(/* ... */)
  }()
}
// å’Œè®¡ç®—å±æ€§ä¸åŒï¼Œå­˜å‚¨å±æ€§å’Œéœ€è¦å­˜å‚¨çš„å»¶è¿Ÿå±æ€§ä¸èƒ½è¢«å®šä¹‰åœ¨æ‰©å±•ä¸­

struct Point {
  var x: Double
  var y: Double
  private(set) lazy var distanceFromOrigin: Double
  = (x*x + y*y).squareRoot()
  init(x: Double, y: Double) {
    self.x = x
    self.y = y
  }
}
// å»¶è¿Ÿå±æ€§çš„å€¼åœ¨ç¬¬ä¸€æ¬¡è®¿é—®æ—¶è¢«è®¾ç½®
var point = Point(x: 3, y: 4)
point.distanceFromOrigin // 5.0
point.x += 10
point.distanceFromOrigin // 5.0

let immutablePoint = Point(x: 3, y: 4)
immutablePoint.distanceFromOrigin
// é”™è¯¯ï¼šä¸èƒ½åœ¨ä¸€ä¸ªä¸å¯å˜é‡ä¸Šä½¿ç”¨å¯å˜ getter
// å»¶è¿Ÿå±æ€§æ˜¯ mutating æ“ä½œï¼Œç»“æ„ä½“ä¸­éœ€è¦å£°æ˜ä¸ºå¯å˜é‡ã€‚
// åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨ä¸æ–¹ä¾¿ï¼Œä¸å»ºè®®

// å¤šçº¿ç¨‹åŒæ­¥è®¿é—®æ—¶è®¡ç®—ä¼šè¿›è¡Œå¤šæ¬¡ï¼Œäº§ç”Ÿå¾ˆå¤šå‰¯ä½œç”¨ã€‚
</code></pre></div></div>
<h3 id="å…­ä¸‹æ ‡">å…­ã€ä¸‹æ ‡</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ä¸‹æ ‡æ˜¯ä½¿ç”¨äº†ç‰¹æ®Šè¯­æ³•çš„å‡½æ•°ï¼ˆ get ï¼‰ï¼Œæ—¢å¯ä»¥åªè¯»ï¼Œä¹Ÿå¯ä»¥è¯»å†™ï¼ˆ get set ï¼‰
// å’Œæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œå¯¹ä¸åŒç±»å‹çš„ä¸‹æ ‡è¿›è¡Œé‡è½½
let fibs = [0, 1, 1, 2, 3, 5]
let first = fibs[0] // 0
fibs[1..&lt;3] // [1, 1]

// ä¸ºè‡ªå®šä¹‰æˆ–å·²å­˜åœ¨çš„ç±»å‹æ·»åŠ ä¸‹æ ‡æ”¯æŒ
// è¿”å›æ•°ç»„ä¸­ç´¢å¼•å¯¹åº”å…ƒç´ çš„æ•°ç»„
// ä¸‰ä¸ªç‚¹è¡¨ç¤º indexList æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”çš„å¤šä¸ªæŒ‡å®šç±»å‹çš„å€¼ï¼ˆ Index ç±»å‹ï¼‰
extension Collection {
  subscript(indices indexList: Index...) -&gt; [Element] {
    var result: [Element] = []
    for index in indexList {
      result.append(self[index])
    }
    return result
  }
}

Array("abcdefghijklmnopqrstuvwxyz")[indices: 7, 4, 11, 11, 14]
// ["h", "e", "l", "l", "o"]
</code></pre></div></div>
<h4 id="1-ä¸‹æ ‡è¿›é˜¶">1. ä¸‹æ ‡è¿›é˜¶</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// å¤šä¸ªå‚æ•°çš„ä¸‹æ ‡
var japan: [String: Any] = [
  "name": "Japan",
  "capital": "Tokyo",
  "population": 126_740_000,
  "coordinates": [
    "latitude": 35.0,
    "longitude": 139.0
  ]
]

// é”™è¯¯ï¼šç±»å‹ 'Any' æ²¡æœ‰ä¸‹æ ‡æˆå‘˜
japan["coordinate"]?["latitude"] = 36.0

// é”™è¯¯ï¼šä¸èƒ½å¯¹ä¸å¯å˜è¡¨è¾¾å¼èµ‹å€¼
(japan["coordinates"] as? [String: Double])?["coordinate"] = 36.0

// æ³›å‹ä¸‹æ ‡çš„æ‰©å±•
// type å‚æ•°æ¥å—ç›®æ ‡ç±»å‹ï¼Œå¹¶åœ¨å®ç°ä¸­å°è¯•è½¬æ¢ç±»å‹
extension Dictionary {
  subscript&lt;Result&gt;(key: Key, as type: Result.Type) -&gt; Result? {
    get {
      return self[key] as? Result
    }
    set {
      guard let value = newValue as? Value else {
        return
      }
      self[key] = value
    }
  }
}

japan["coordinates", as: [String: Double].self]?["latitude"] = 36.0
japan["coordinates"] // Optional(["latitude": 36.0, "longitude": 139.0])
// å¤§å¤šæƒ…å†µä¸‹ä¸ºæ•°æ®å±€è‡ªå®šä¹‰ç±»å‹ï¼Œè¿™é‡Œ Country å¯ä»¥å®šä¹‰ç»“æ„ä½“ï¼Œæ»¡è¶³ Codable åè®®åœ¨å€¼å’Œæ•°æ®é—´è½¬æ¢ã€‚
</code></pre></div></div>
<h3 id="ä¸ƒé”®è·¯å¾„">ä¸ƒã€é”®è·¯å¾„</h3>
<ul>
  <li>Swift4 æ·»åŠ äº†é”®è·¯å¾„çš„æ¦‚å¿µã€‚</li>
  <li>é”®è·¯å¾„æ˜¯ä¸€ä¸ªæŒ‡å‘å±æ€§çš„æœªè°ƒç”¨çš„å¼•ç”¨ï¼Œä¸æ–¹æ³•æœªä½¿ç”¨çš„å¼•ç”¨ç±»ä¼¼ã€‚</li>
  <li>é”®è·¯å¾„è¡¨è¾¾å¼ä»¥ä¸€ä¸ªåæ–œæ å¼€å¤´ï¼Œå¦‚ \String.countï¼Œåæ–œæ ç”¨æ¥åŒºåˆ†é”®è·¯å¾„å’ŒåŒåçš„ç±»å‹å±æ€§ã€‚<br />
ï¼ˆå‡å¦‚ String ä¹Ÿæœ‰ä¸€ä¸ª static count å±æ€§çš„è¯ï¼ŒString.count è¿”å›çš„å°±ä¼šæ˜¯è¿™ä¸ªå±æ€§å€¼äº†
ï¼‰</li>
  <li>ç±»å‹æ¨æ–­å¯¹é”®è·¯å¾„æœ‰æ•ˆï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®ä¸Šç»†çº¹æ¨æ–­ï¼Œå¯ä»¥èƒœç‡ç±»å‹ï¼Œåªå†™ .countã€‚</li>
  <li>é”®è·¯å¾„æè¿°äº†ä¸€ä¸ªå€¼ä»æ ¹è·¯å¾„å¼€å§‹çš„å±‚çº§è·¯å¾„ã€‚</li>
  <li>é”®è·¯å¾„å¯ä»¥ç”±ä»»æ„çš„å­˜å‚¨å’Œè®¡ç®—å±æ€§é†‹å’Œè€Œæˆï¼Œå¯ä»¥åŒ…å«å¯é€‰é“¾æ“ä½œç¬¦ã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// \Person.address.street è¡¨è¾¾äº†ä¸€ä¸ªäººçš„è¡—é“ä½å€çš„é”®è·¯å¾„
struct Address {
  var street: String
  var city: String
  var zipCode: Int
}
struct Person {
  let name: String
  var address: Address
}
let streetKeyPath = \Person.address.street // WritableKeyPath&lt;Person, String&gt;
let nameKeyPath = \Person.name // KeyPath&lt;Person, String&gt;

// ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºæ‰€æœ‰ç±»å‹ç”Ÿæˆ [keyPath:] çš„ä¸‹æ ‡æ–¹æ³•ï¼Œé€šè¿‡é”®è·¯å¾„è®¿é—®æ‰€æè¿°çš„å±æ€§ã€‚
// Hello"[keyPath: \.count] ç­‰æ•ˆäº "Hello".count
let simpsonResidence = Address(street: "1094 Evergreen Terrace",
city: "Springfield", zipCode: 97475)
var lisa = Person(name: "Lisa Simpson", address: simpsonResidence)
lisa[keyPath: nameKeyPath] // Lisa Simpson

// nameKeyPath ç±»å‹ï¼š KeyPath&lt;Person, String&gt;ã€‚å¼ºç±»å‹ï¼Œè¡¨ç¤ºè¯¥é”®è·¯å¾„å¯ä»¥ä½œç”¨äº Personï¼Œå¹¶è¿”å›ä¸€ä¸ª Stringã€‚
// streetKeyPath ç±»å‹ï¼šWritableKeyPathï¼Œæ„æˆè¿™ä¸ªé”®è·¯å¾„çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå¯å†™é”®è·¯å¾„æœ¬èº«å…è®¸å…¶ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–ã€‚
lisa[keyPath: streetKeyPath] = "742 Evergreen Terrace
// å¯¹ nameKeyPath åŒæ ·æ“ä½œä¼šå‡ºé”™ï¼Œå› ä¸ºå®ƒå¯¹åº”çš„å±æ€§æ˜¯ä¸å¯å˜çš„ã€‚
</code></pre></div></div>
<h4 id="1-å¯ä»¥é€šè¿‡å‡½æ•°å»ºæ¨¡çš„é”®è·¯å¾„">1. å¯ä»¥é€šè¿‡å‡½æ•°å»ºæ¨¡çš„é”®è·¯å¾„</h4>
<ul>
  <li>é”®è·¯å¾„æ˜¯å€¼ï¼Œå¯ä»¥æµ‹è¯•æ˜¯å¦ç›¸ç­‰ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œå­—å…¸çš„é”®ï¼ˆéµå®ˆ Hashableï¼‰ã€‚</li>
  <li>é”®è·¯å¾„ä¸åŒ…å«çŠ¶æ€ï¼Œä¸ä¼šæ•è·æ˜¯å¦å¯å˜ï¼Œå‡½æ•°æ— æ³•åšåˆ°ã€‚</li>
  <li>é”®è·¯å¾„åœ¨ç±»å‹åŒ¹é…çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡è®²ä¸€ä¸ªè·¯å¾„é™„åŠ åˆ°å¦ä¸€ä¸ªé”®è·¯å¾„çš„æ–¹å¼ç”Ÿæˆã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// A -&gt; B -&gt; Cï¼Œé™„åŠ é”®è·¯å¾„çš„æ ¹ç±»å‹ B ï¼Œå¾—åˆ° A -&gt; C çš„é”®è·¯å¾„ã€‚
// KeyPath&lt;Person, String&gt; + KeyPath&lt;String, Int&gt; = KeyPath&lt;Person, Int&gt;
let nameCountKeyPath = nameKeyPath.appending(path: \.count)
// Swift.KeyPath&lt;Person, Swift.Int&gt;

// é€šè¿‡ä¸€ä¸ª (Key) -&gt; Value æ¥å®šä¹‰äº† sortDescriptor
typealias SortDescriptor&lt;Value&gt; = (Value, Value) -&gt; Bool
func sortDescriptor&lt;Value, Key&gt;(key: @escaping (Value) -&gt; Key)
-&gt; SortDescriptor&lt;Value&gt; where Key: Comparable {
  return { key($0) &lt; key($1) }
}
// ä½¿ç”¨
let streetSD: SortDescriptor&lt;Person&gt; = sortDescriptor { $0.address.street }

// é€šè¿‡é”®è·¯å¾„æ¥æ·»åŠ ä¸€ç§æ’åºæè¿°ç¬¦çš„æ„å»ºæ–¹å¼
func sortDescriptor&lt;Value, Key&gt;(key: KeyPath&lt;Value, Key&gt;)
-&gt; SortDescriptor&lt;Value&gt; where Key: Comparable {
  return { $0[keyPath: key] &lt; $1[keyPath: key] }
}
// ä½¿ç”¨
let streetSDKeyPath: SortDescriptor&lt;Person&gt; =
sortDescriptor(key: \.address.street)
// é”®è·¯å¾„ä¾èµ– Value æ»¡è¶³ Comparableï¼Œå¾ˆéš¾ä½¿ç”¨å¦ä¸€ç§æ’åºæ–­è¨€æ—¶ï¼Œå¦‚ï¼šå¿½ç•¥å¤§å°å†™æŒ‰åŒºåŸŸæ¯”è¾ƒ
</code></pre></div></div>
<h4 id="2-å¯å†™é”®è·¯å¾„">2. å¯å†™é”®è·¯å¾„</h4>
<ul>
  <li>é€šè¿‡å¯å†™é”®è·¯å¾„è¯»å–æˆ–è€…å†™å…¥å€¼ï¼Œè·å–å±æ€§å€¼ ((Root) -&gt;Value)ï¼Œè®¾ç½®å±æ€§å€¼ ((inout Root, Value) -&gt; Void)</li>
  <li>å¯å†™è·¯å¾„åœ¨å¤„ç†ä¸¤ä¸ªå±æ€§äº’ç›¸ç»‘å®šæ—¶ï¼Œç‰¹åˆ«æ–¹ä¾¿ã€‚å…¶ä¸­ä¸€ä¸ªå±æ€§æ”¹å˜æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°ã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let streetKeyPath = .address.street
let getStreet: (Person) -&gt; String = { person in
  return person.address.street
}
let setStreet: (inout Person, String) -&gt; () = { person, newValue in
  person.address.street = newValue
}

// ä½¿ç”¨
lisa[keyPath: streetKeyPath] // 742 Evergreen Terrace
getStreet(lisa) // 742 Evergreen Terrace

// è°ƒç”¨è€…æŒ‡å®šä¸¤ä¸ªå¯¹è±¡å’Œä¸¤ä¸ªé”®è·¯å¾„ï¼Œå®ç°åŒæ­¥æ›´æ–°
// å¯¹æ‰€æœ‰ NSObject å­ç±»å®šä¹‰è¯¥æ–¹æ³•
// NSKeyValueObservation æ˜¯ä¸€ä¸ª tokenï¼Œè°ƒç”¨è€…é€šè¿‡ä»–æ§åˆ¶è§‚å¯Ÿçš„ç”Ÿå‘½å‘¨æœŸï¼Œtoken å¯¹è±¡è¢«é”€æ¯æˆ–
è°ƒç”¨è€…è°ƒç”¨å®ƒçš„ invalidate æ–¹æ³•æ—¶åœæ­¢ã€‚
// NSObject ä¸Šçš„ observe(_:options:changeHandler:) æ–¹æ³•å°†ä¼šå¯¹ä¸€ä¸ª (Swift çš„å¼ºç±»å‹)
é”®è·¯å¾„è¿›è¡Œè§‚å¯Ÿï¼Œå¹¶åœ¨å±æ€§å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è°ƒç”¨ handlerã€‚
extension NSObjectProtocol where Self: NSObject {
  func observe&lt;A, Other&gt;(_ keyPath: KeyPath&lt;Self, A&gt;,
  writeTo other: Other,
  _ otherKeyPath: ReferenceWritableKeyPath&lt;Other, A&gt;)
  -&gt; NSKeyValueObservation
  where A: Equatable, Other: NSObjectProtocol
  {
    return observe(keyPath, options: .new) { _, change in
      guard let newValue = change.newValue,
      other[keyPath: otherKeyPath] != newValue else {
        return // prevent endless feedback loop
      }
      other[keyPath: otherKeyPath] = newValue
    }
  }

  func bind&lt;A, Other&gt;(_ keyPath: ReferenceWritableKeyPath&lt;Self,A&gt;,
  to other: Other,
  _ otherKeyPath: ReferenceWritableKeyPath&lt;Other,A&gt;)
  -&gt; (NSKeyValueObservation, NSKeyValueObservation)
  where A: Equatable, Other: NSObject
  {
    let one = observe(keyPath, writeTo: other, otherKeyPath)
    let two = other.observe(otherKeyPath, writeTo: self, keyPath)
    return (one,two)
  }
}

// æ„å»º Sample å’Œ MyObj å¯¹è±¡ï¼Œå°† name å’Œ test å±æ€§äº’ç›¸ç»‘å®š
final class Sample: NSObject {
  // @objc å£°æ˜æ—¶ï¼ŒKVO å·¥ä½œï¼Œæ¿€æ´»æ–¹æ³• observe(_:options:changeHandler:)ã€‚
  @objc dynamic var name: String = ""
}
class MyObj: NSObject {
  @objc dynamic var test: String = ""
}
let sample = Sample()
let other = MyObj()
let observation = sample.bind(\Sample.name, to: other, \.test)
sample.name = "NEW"
other.test // NEW
other.test = "HI"
sample.name // HI
</code></pre></div></div>
<h4 id="3-é”®è·¯å¾„å±‚çº§">3. é”®è·¯å¾„å±‚çº§</h4>
<p>é”®è·¯å¾„çš„äº”ä¸ªå±‚çº§ï¼Œä¸‹å±‚æä¾›äº†æ›´ç²¾ç¡®çš„æè¿°å’ŒåŠŸèƒ½</p>
<ul>
  <li>AnyKeyPath å’Œ (Any) -&gt; Any? ç±»å‹çš„å‡½æ•°ç›¸ä¼¼</li>
  <li>PartialKeyPath<source /> å’Œ (Source) -&gt; Any? å‡½æ•°ç›¸ä¼¼</li>
  <li>KeyPath&lt;Source, Target&gt; å’Œ (Source) -&gt; Target å‡½æ•°ç›¸ä¼¼</li>
  <li>WritableKeyPath&lt;Source, Target&gt; å’Œ (Source) -&gt; Target ä¸ (inout Source, Target) -&gt; () è¿™ä¸€å¯¹å‡½æ•°ç›¸ä¼¼</li>
  <li>ReferenceWritableKeyPath&lt;Source, Target&gt; å’Œ (Source) -&gt; Target ä¸ (Source, Target) -&gt; () è¿™ä¸€å¯¹å‡½æ•°ç›¸ä¼¼ã€‚ç¬¬äºŒä¸ªå‡½æ•°å¯ä»¥ç”¨ Target æ¥æ›´æ–° Source çš„å€¼ï¼Œä¸”è¦æ±‚ Source æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ã€‚å¯¹ WritableKeyPath å’Œ ReferenceWritableKeyPath è¿›è¡ŒåŒºåˆ†æ˜¯å¿…è¦çš„ï¼Œå‰ä¸€ä¸ªç±»å‹çš„ setter è¦æ±‚å®ƒçš„å‚æ•°æ˜¯ inout çš„ã€‚</li>
</ul>

<h4 id="4-å¯¹æ¯”-objective-c-çš„é”®è·¯å¾„">4. å¯¹æ¯” Objective-C çš„é”®è·¯å¾„</h4>
<p>Foundation å’Œ Objective-C ä¸­é”®è·¯å¾„é€šè¿‡å­—ç¬¦ä¸²å»ºæ¨¡ï¼Œä¼šå­˜åœ¨ç”±äºè·¯å¾„æ‹¼å†™é”™è¯¯åŒ¹é…ä¸åˆ°ç±»å‹ã€æ²¡æœ‰æ­£ç¡®ç”Ÿæˆç­‰æƒ…å†µå¯¼è‡´çš„ç¨‹åºå´©æºƒã€‚
è€Œ Swift ä¸­ï¼Œé”®è·¯å¾„æ˜¯KeyPathã€WritableKeypath å’Œ ReferenceWritableKeyPath ä»äº§ç”Ÿçš„ï¼Œå¼€å§‹å°±æ˜¯æ­£ç¡®çš„ã€‚</p>
<h4 id="5-æœªæ¥æ–¹å‘">5. æœªæ¥æ–¹å‘</h4>
<ul>
  <li>é€šè¿‡ Codable è¿›è¡Œåºåˆ—åŒ–ï¼Œå°†é”®è·¯å¾„å­˜å‚¨åˆ°ç£ç›˜æˆ–é€šè¿‡ç½‘ç»œä¼ é€’ã€‚ä½¿ç”¨é”®è·¯å¾„ç»“æ„æ„ä»¶æ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼Œå¯¹æ•°æ®åº“å†…çœï¼ˆè¿è¡Œæ—¶æ£€æŸ¥ï¼‰ã€‚
ä¹Ÿå¯ä»¥ç”¨äºè¿è¡Œæ—¶åå°„ APIã€‚</li>
  <li>å¯¹é”®è·¯å¾„æ·»åŠ ä¸‹æ ‡è¡¨è¾¾å¼ï¼Œå¦‚ï¼š[String].[n].count çš„å†™æ³•ã€‚</li>
</ul>

<h3 id="å…«è‡ªåŠ¨é—­åŒ…">å…«ã€è‡ªåŠ¨é—­åŒ…</h3>
<ul>
  <li>@autoclosure æ ‡æ³¨ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å°†å‚æ•°ç”¨é—­åŒ…è¡¨è¾¾å¼åŒ…è£…èµ·æ¥</li>
  <li>Swift æ ‡å‡†åº“ä¸­ï¼Œassert å’Œ fatalError ä¹Ÿä½¿ç”¨äº† autoclosureï¼Œç¡®å®éœ€è¦æ—¶æ‰å¯¹å‚æ•°æ±‚å€¼ã€‚
ä»æ–­è¨€è°ƒç”¨æ—¶æ±‚å€¼æ¨è¿Ÿåˆ° assert å‡½æ•°å†…éƒ¨ï¼Œç§»é™¤æ˜‚è´µçš„æ“ä½œã€‚</li>
  <li>å¯ä»¥åœ¨è®¾è®¡æ—¥å¿—å‡½æ•°æ—¶ï¼Œåˆ©ç”¨ç±»ä¼¼ assert çš„è®¾è®¡æ–¹å¼ï¼ŒèŠ‚çœå¼€é”€ã€‚</li>
  <li>è¿‡åº¦ä½¿ç”¨è‡ªåŠ¨é—­åŒ…å¯èƒ½ä¼šè®©ä½ çš„ä»£ç éš¾ä»¥ç†è§£ã€‚ä½¿ç”¨æ—¶çš„ä¸Šä¸‹æ–‡å’Œå‡½æ•°ååº”è¯¥æ¸…æ™°åœ°æŒ‡å‡ºå®é™…æ±‚å€¼ä¼šè¢«æ¨è¿Ÿã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let evens = [2,4,6]
// &amp;&amp;, çŸ­è·¯æ±‚å€¼ï¼Œå·¦è¾¹è¡¨è¾¾å¼æˆç«‹ï¼Œæ‰ä¼šåˆ¤æ–­å³è¾¹
// å¦‚æœæ²¡æœ‰æ¡ä»¶çŸ­è·¯ï¼Œæ•°ç»„ä¸ºç©ºæ—¶ä¼šå¯¼è‡´å´©æºƒ
if !evens.isEmpty &amp;&amp; evens[0] &gt; 10 {
  // æ‰§è¡Œæ“ä½œ
}

// è‡ªå®šä¹‰å’Œ &amp;&amp; æ“ä½œç¬¦ç›¸åŒçš„ and å‡½æ•°
func and(_ l: Bool, _ r: () -&gt; Bool) -&gt; Bool {
  guard l else { return false }
  return r()
}

// ä½¿ç”¨
if and(!evens.isEmpty, { evens[0] &gt; 10 }) {
  // æ‰§è¡Œæ“ä½œ
}

// @autoclosure æ ‡æ³¨ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å°†å‚æ•°ç”¨é—­åŒ…è¡¨è¾¾å¼åŒ…è£…èµ·æ¥
func and(_ l: Bool, _ r: @autoclosure () -&gt; Bool) -&gt; Bool {
  guard l else { return false }
  return r()
}
// ä½¿ç”¨
if and(!evens.isEmpty, evens[0] &gt; 10) {
  // æ‰§è¡Œæ“ä½œ
}

// æ—¥å¿—å‡½æ•°ï¼Œæ¡ä»¶ä¸º true æ—¶æ‰§è¡Œå¹¶è·å–è¾“å‡ºä¿¡æ¯çš„ log å‡½æ•°
func log(ifFalse condition: Bool,
message: @autoclosure () -&gt; (String),
file: String = #file, function: String = #function, line: Int = #line)
{
  guard !condition else { return }
  print("Assertion failed: \(message()), \(file):\(function) (line \(line))")
}

</code></pre></div></div>
<h4 id="1-escaping-æ ‡æ³¨">1. @escaping æ ‡æ³¨</h4>
<ul>
  <li>é€ƒé€¸é—­åŒ…ï¼šä¸€ä¸ªè¢«ä¿å­˜åœ¨æŸä¸ªåœ°æ–¹ç­‰å¾…ç¨å (æ¯”å¦‚å‡½æ•°è¿”å›ä»¥å) å†è°ƒç”¨çš„é—­åŒ…</li>
  <li>é—­åŒ…é»˜è®¤æ˜¯éé€ƒé€¸çš„ï¼Œå¦‚æœæƒ³è¦ç¨åä½¿ç”¨ï¼Œéœ€è¦æ·»åŠ å‚æ•° @escapingï¼Œå¦åˆ™ä¸å…è®¸ä¿å­˜æˆ–è¿”å›ç»™è°ƒç”¨è€…ã€‚</li>
  <li>é»˜è®¤éå®ƒé€ƒé€¸è§„åˆ™åªå¯¹å‡½æ•°å‚æ•°å’Œç›´æ¥å‚æ•°ä½ç½®çš„å‡½æ•°ç±»å‹æœ‰æ•ˆã€‚é—­åŒ…å°è£…åœ¨å¤šå…ƒç»„å’Œå¯é€‰å€¼ç±»å‹æ—¶ï¼Œä¸æ˜¯ç›´æ¥å‚æ•°ï¼Œ
è‡ªåŠ¨å˜æˆé€ƒé€¸é—­åŒ…ã€‚ä¸å­˜åœ¨å¯é€‰å€¼çš„éé€ƒé€¸é—­åŒ…ï¼Œï¼Œå¯ä»¥é€šè¿‡è®¾ç½®é»˜è®¤å€¼é¿å…å¯é€‰å€¼ï¼Œæˆ–ä½¿ç”¨é‡è½½å‡½æ•°åŒæ—¶æä¾›ä¸å¯é€‰çš„å‡½æ•°ç»•è¿‡é™åˆ¶ã€‚</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// onRotate æ˜¯é€ƒé€¸é—­åŒ…ï¼Œä½¿ç”¨ weak é¿å…å¾ªç¯å¼•ç”¨
window?.onRotate = { [weak view] in
  print("We now also need to update the view: \(view)")
}

// @escaping å£°æ˜é€ƒé€¸é—­åŒ…
func sortDescriptor&lt;Value, Key&gt;(
key: @escaping (Value) -&gt; Key,
by areInIncreasingOrder: @escaping (Key, Key) -&gt; Bool)
-&gt; SortDescriptor&lt;Value&gt;
{
  return { areInIncreasingOrder(key($0), key($1)) }
}

// æä¾›é‡è½½å‡½æ•°ï¼Œç»•è¿‡å¯é€‰å’Œé€ƒé€¸äºŒè€…ä¸å¯åŒæ—¶å­˜åœ¨è§„åˆ™çš„é™åˆ¶
func transform(_ input: Int, with f: ((Int) -&gt; Int)?) -&gt; Int {
  print("ä½¿ç”¨å¯é€‰å€¼é‡è½½")
  guard let f = f else { return input }
  return f(input)
}
func transform(_ input: Int, with f: (Int) -&gt; Int) -&gt; Int {
  print("ä½¿ç”¨éå¯é€‰å€¼é‡è½½")
  return f(input)
}

transform(10, with: nil) // ä½¿ç”¨å¯é€‰å€¼é‡è½½
transform(10) { $0 * $0 } // ä½¿ç”¨éå¯é€‰å€¼é‡è½½
</code></pre></div></div>
<h4 id="2-withoutactuallyescaping">2. withoutActuallyEscaping</h4>
<p>withoutActuallyEscaping ç¡®å®šé—­åŒ…ä¸ä¼šé€ƒé€¸ï¼Œå­˜åœ¨ä¸å®‰å…¨éšæ‚£ã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// å¯¹æ•°ç»„çš„å»¶è¿Ÿè¡¨ç¤ºåˆ›å»ºè¿‡æ»¤å™¨ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å…ƒç´ èƒ½å¤Ÿé€šè¿‡ï¼Œæ‰¾åˆ°ä¸åŒ¹é…çš„æ¡ç›®åœæ­¢ã€‚
// ç¡®å®šé—­åŒ…ä¸ä¼šé€ƒé€¸ï¼Œå› ä¸ºå»¶è¿Ÿé›†åˆçš„å£°æ˜å‘¨æœŸç»‘å®šåœ¨å‡½æ•°ä¸Šã€‚
extension Array {
  func all(matching predicate: (Element) -&gt; Bool) -&gt; Bool {
    // é”™è¯¯ï¼š'predicate' å‚æ•°éšå¼éé€ƒé€¸
    return self.lazy.filter({ !predicate($0) }).isEmpty
  }
}

extension Array {
  func all(matching predicate: (Element) -&gt; Bool) -&gt; Bool {
    return withoutActuallyEscaping(predicate) { escapablePredicate in
      self.lazy.filter { escapablePredicate($0) }.isEmpty
    }
  }
}
let areAllEven = [1,2,3,4].all { $0 % 2 == 0 } // false
let areAllOneDigit = [1,2,3,4].all { $0 &lt; 10 } // true
</code></pre></div></div>
:ET